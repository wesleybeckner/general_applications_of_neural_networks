
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.2.3, mkdocs-material-8.1.4">
    
    
      
        <title>Reinforcement Learning Agents - General Applications of Neural Networks</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.bb3983ee.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.e6a45f82.min.css">
        
      
    
    
    
      
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../extra.css">
    
      <link rel="stylesheet" href="../../styles.css">
    
    <script>__md_scope=new URL("../..",location),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      
  


  
  


  <script>window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","UA-114664473-1","auto"),ga("set","anonymizeIp",!0),ga("send","pageview"),document.addEventListener("DOMContentLoaded",function(){document.forms.search&&document.forms.search.query.addEventListener("blur",function(){var e;this.value&&(e=document.location.pathname,ga("send","pageview",e+"?q="+this.value))}),"undefined"!=typeof location$&&location$.subscribe(function(e){ga("send","pageview",e.pathname)})})</script>
  <script async src="https://www.google-analytics.com/analytics.js"></script>


    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="" data-md-color-accent="">
  
    
    
      <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#general-applications-of-neural-networks-x1-reinforcement-learning-based-agents" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="General Applications of Neural Networks" class="md-header__button md-logo" aria-label="General Applications of Neural Networks" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            General Applications of Neural Networks
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Reinforcement Learning Agents
            
          </span>
        </div>
      </div>
    </div>
    
      <form class="md-header__option" data-md-component="palette">
        
          
          
          <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="" data-md-color-accent=""  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
          
            <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_2" hidden>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 6H7c-3.31 0-6 2.69-6 6s2.69 6 6 6h10c3.31 0 6-2.69 6-6s-2.69-6-6-6zm0 10H7c-2.21 0-4-1.79-4-4s1.79-4 4-4h10c2.21 0 4 1.79 4 4s-1.79 4-4 4zM7 9c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"/></svg>
            </label>
          
        
          
          
          <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="" data-md-color-accent=""  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_2">
          
            <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3z"/></svg>
            </label>
          
        
      </form>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="General Applications of Neural Networks" class="md-nav__button md-logo" aria-label="General Applications of Neural Networks" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    General Applications of Neural Networks
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        About
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../introduction/" class="md-nav__link">
        Introduction
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3" type="checkbox" id="__nav_3" >
      
      
      
      
        <label class="md-nav__link" for="__nav_3">
          Sessions
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Sessions" data-md-level="1">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          Sessions
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../S1_Multilayer_Perceptron/" class="md-nav__link">
        The Multilayer Perceptron
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../S2_Feed_Forward_Neural_Networks/" class="md-nav__link">
        Feed Forward Neural Networks
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../S3_Computer_Vision_I/" class="md-nav__link">
        Computer Vision I
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../S4_Computer_Vision_II/" class="md-nav__link">
        Computer Vision II
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../S5_Flask/" class="md-nav__link">
        Applications with Flask
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../S6_Time_Series_Analysis/" class="md-nav__link">
        Time Series Analysis
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../S7_Data_Dashboards_with_Plotly_Dash/" class="md-nav__link">
        Dashboards with Plotly Dash
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4" type="checkbox" id="__nav_4" >
      
      
      
      
        <label class="md-nav__link" for="__nav_4">
          Labs
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Labs" data-md-level="1">
        <label class="md-nav__title" for="__nav_4">
          <span class="md-nav__icon md-icon"></span>
          Labs
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../labs/L1_Neural_Network_Linearity/" class="md-nav__link">
        Neural Network Linearity
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_5" type="checkbox" id="__nav_5" >
      
      
      
      
        <label class="md-nav__link" for="__nav_5">
          Project
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Project" data-md-level="1">
        <label class="md-nav__title" for="__nav_5">
          <span class="md-nav__icon md-icon"></span>
          Project
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../project/P1_Monolithic/" class="md-nav__link">
        Monolithic Tic-Tac-Toe App
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_6" type="checkbox" id="__nav_6" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_6">
          Extras
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Extras" data-md-level="1">
        <label class="md-nav__title" for="__nav_6">
          <span class="md-nav__icon md-icon"></span>
          Extras
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Reinforcement Learning Agents
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Reinforcement Learning Agents
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#10-preparing-environment-and-importing-data" class="md-nav__link">
    1.0 Preparing Environment and Importing Data
  </a>
  
    <nav class="md-nav" aria-label="1.0 Preparing Environment and Importing Data">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#101-import-packages" class="md-nav__link">
    1.0.1 Import Packages
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#102-run-tests" class="md-nav__link">
    1.0.2 Run Tests
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#11-reinforcement-learning-reset-step-and-reward" class="md-nav__link">
    1.1 Reinforcement Learning: Reset, Step, and Reward
  </a>
  
    <nav class="md-nav" aria-label="1.1 Reinforcement Learning: Reset, Step, and Reward">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#112-reset" class="md-nav__link">
    1.1.2 Reset
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#113-observation-and-action-spaces" class="md-nav__link">
    1.1.3 Observation and Action Spaces
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#114-step-reward" class="md-nav__link">
    1.1.4 Step-Reward
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#115-testing-the-environment" class="md-nav__link">
    1.1.5 Testing the Environment
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#116-training-the-model" class="md-nav__link">
    1.1.6 Training the Model
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#117-play-against-the-model" class="md-nav__link">
    1.1.7 Play Against the Model
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#12-improve-the-model" class="md-nav__link">
    1.2 Improve the Model
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#10-preparing-environment-and-importing-data" class="md-nav__link">
    1.0 Preparing Environment and Importing Data
  </a>
  
    <nav class="md-nav" aria-label="1.0 Preparing Environment and Importing Data">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#101-import-packages" class="md-nav__link">
    1.0.1 Import Packages
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#102-run-tests" class="md-nav__link">
    1.0.2 Run Tests
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#11-reinforcement-learning-reset-step-and-reward" class="md-nav__link">
    1.1 Reinforcement Learning: Reset, Step, and Reward
  </a>
  
    <nav class="md-nav" aria-label="1.1 Reinforcement Learning: Reset, Step, and Reward">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#112-reset" class="md-nav__link">
    1.1.2 Reset
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#113-observation-and-action-spaces" class="md-nav__link">
    1.1.3 Observation and Action Spaces
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#114-step-reward" class="md-nav__link">
    1.1.4 Step-Reward
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#115-testing-the-environment" class="md-nav__link">
    1.1.5 Testing the Environment
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#116-training-the-model" class="md-nav__link">
    1.1.6 Training the Model
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#117-play-against-the-model" class="md-nav__link">
    1.1.7 Play Against the Model
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#12-improve-the-model" class="md-nav__link">
    1.2 Improve the Model
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                

<p><a href="https://colab.research.google.com/github/wesleybeckner/general_applications_of_neural_networks/blob/main/notebooks/extras/X1_Tictactoe_RNN.ipynb" target="_parent"><img src="https://colab.research.google.com/assets/colab-badge.svg" alt="Open In Colab"/></a></p>
<h1 id="general-applications-of-neural-networks-x1-reinforcement-learning-based-agents">General Applications of Neural Networks <br> X1: Reinforcement Learning Based Agents<a class="headerlink" href="#general-applications-of-neural-networks-x1-reinforcement-learning-based-agents" title="Permanent link">&para;</a></h1>
<p><strong>Instructor</strong>: Wesley Beckner</p>
<p><strong>Contact</strong>: <a href="&#109;&#97;&#105;&#108;&#116;&#111;&#58;&#119;&#101;&#115;&#108;&#101;&#121;&#98;&#101;&#99;&#107;&#110;&#101;&#114;&#64;&#103;&#109;&#97;&#105;&#108;&#46;&#99;&#111;&#109;">&#119;&#101;&#115;&#108;&#101;&#121;&#98;&#101;&#99;&#107;&#110;&#101;&#114;&#64;&#103;&#109;&#97;&#105;&#108;&#46;&#99;&#111;&#109;</a></p>
<hr />
<p><br></p>
<p>In this lesson we'll abandon the world of heuristical agents and embrace the wilds of reinforcement learning</p>
<p><br></p>
<hr />
<p><a name='x.0'></a></p>
<h2 id="10-preparing-environment-and-importing-data">1.0 Preparing Environment and Importing Data<a class="headerlink" href="#10-preparing-environment-and-importing-data" title="Permanent link">&para;</a></h2>
<p><a href="#top">back to top</a></p>
<p><a name='x.0.1'></a></p>
<h3 id="101-import-packages">1.0.1 Import Packages<a class="headerlink" href="#101-import-packages" title="Permanent link">&para;</a></h3>
<p><a href="#top">back to top</a></p>
<p>baselines requires an older version of TF</p>
<div class="codehilite"><pre><span></span><code><span class="n">pip</span> <span class="n">install</span> <span class="n">tensorflow</span><span class="o">==</span><span class="mf">1.15.0</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code>Collecting tensorflow==1.15.0
  Downloading tensorflow-1.15.0-cp37-cp37m-manylinux2010_x86_64.whl (412.3 MB)
[K     |████████████████████████████████| 412.3 MB 25 kB/s 
[?25hCollecting keras-applications&gt;=1.0.8
  Downloading Keras_Applications-1.0.8-py3-none-any.whl (50 kB)
[K     |████████████████████████████████| 50 kB 6.1 MB/s 
[?25hRequirement already satisfied: protobuf&gt;=3.6.1 in /usr/local/lib/python3.7/dist-packages (from tensorflow==1.15.0) (3.17.3)
Requirement already satisfied: google-pasta&gt;=0.1.6 in /usr/local/lib/python3.7/dist-packages (from tensorflow==1.15.0) (0.2.0)
Collecting tensorboard&lt;1.16.0,&gt;=1.15.0
  Downloading tensorboard-1.15.0-py3-none-any.whl (3.8 MB)
[K     |████████████████████████████████| 3.8 MB 44.6 MB/s 
[?25hCollecting tensorflow-estimator==1.15.1
  Downloading tensorflow_estimator-1.15.1-py2.py3-none-any.whl (503 kB)
[K     |████████████████████████████████| 503 kB 55.6 MB/s 
[?25hRequirement already satisfied: numpy&lt;2.0,&gt;=1.16.0 in /usr/local/lib/python3.7/dist-packages (from tensorflow==1.15.0) (1.21.5)
Requirement already satisfied: six&gt;=1.10.0 in /usr/local/lib/python3.7/dist-packages (from tensorflow==1.15.0) (1.15.0)
Requirement already satisfied: absl-py&gt;=0.7.0 in /usr/local/lib/python3.7/dist-packages (from tensorflow==1.15.0) (1.0.0)
Collecting gast==0.2.2
  Downloading gast-0.2.2.tar.gz (10 kB)
Requirement already satisfied: wrapt&gt;=1.11.1 in /usr/local/lib/python3.7/dist-packages (from tensorflow==1.15.0) (1.13.3)
Requirement already satisfied: grpcio&gt;=1.8.6 in /usr/local/lib/python3.7/dist-packages (from tensorflow==1.15.0) (1.43.0)
Requirement already satisfied: wheel&gt;=0.26 in /usr/local/lib/python3.7/dist-packages (from tensorflow==1.15.0) (0.37.1)
Requirement already satisfied: astor&gt;=0.6.0 in /usr/local/lib/python3.7/dist-packages (from tensorflow==1.15.0) (0.8.1)
Requirement already satisfied: opt-einsum&gt;=2.3.2 in /usr/local/lib/python3.7/dist-packages (from tensorflow==1.15.0) (3.3.0)
Requirement already satisfied: termcolor&gt;=1.1.0 in /usr/local/lib/python3.7/dist-packages (from tensorflow==1.15.0) (1.1.0)
Requirement already satisfied: keras-preprocessing&gt;=1.0.5 in /usr/local/lib/python3.7/dist-packages (from tensorflow==1.15.0) (1.1.2)
Requirement already satisfied: h5py in /usr/local/lib/python3.7/dist-packages (from keras-applications&gt;=1.0.8-&gt;tensorflow==1.15.0) (3.1.0)
Requirement already satisfied: markdown&gt;=2.6.8 in /usr/local/lib/python3.7/dist-packages (from tensorboard&lt;1.16.0,&gt;=1.15.0-&gt;tensorflow==1.15.0) (3.3.6)
Requirement already satisfied: setuptools&gt;=41.0.0 in /usr/local/lib/python3.7/dist-packages (from tensorboard&lt;1.16.0,&gt;=1.15.0-&gt;tensorflow==1.15.0) (57.4.0)
Requirement already satisfied: werkzeug&gt;=0.11.15 in /usr/local/lib/python3.7/dist-packages (from tensorboard&lt;1.16.0,&gt;=1.15.0-&gt;tensorflow==1.15.0) (1.0.1)
Requirement already satisfied: importlib-metadata&gt;=4.4 in /usr/local/lib/python3.7/dist-packages (from markdown&gt;=2.6.8-&gt;tensorboard&lt;1.16.0,&gt;=1.15.0-&gt;tensorflow==1.15.0) (4.11.1)
Requirement already satisfied: zipp&gt;=0.5 in /usr/local/lib/python3.7/dist-packages (from importlib-metadata&gt;=4.4-&gt;markdown&gt;=2.6.8-&gt;tensorboard&lt;1.16.0,&gt;=1.15.0-&gt;tensorflow==1.15.0) (3.7.0)
Requirement already satisfied: typing-extensions&gt;=3.6.4 in /usr/local/lib/python3.7/dist-packages (from importlib-metadata&gt;=4.4-&gt;markdown&gt;=2.6.8-&gt;tensorboard&lt;1.16.0,&gt;=1.15.0-&gt;tensorflow==1.15.0) (3.10.0.2)
Requirement already satisfied: cached-property in /usr/local/lib/python3.7/dist-packages (from h5py-&gt;keras-applications&gt;=1.0.8-&gt;tensorflow==1.15.0) (1.5.2)
Building wheels for collected packages: gast
  Building wheel for gast (setup.py) ... [?25l[?25hdone
  Created wheel for gast: filename=gast-0.2.2-py3-none-any.whl size=7554 sha256=e3a2fe22299f0c6d241d9b04ee068f2d4963266bcdd239d3b3e261e433003838
  Stored in directory: /root/.cache/pip/wheels/21/7f/02/420f32a803f7d0967b48dd823da3f558c5166991bfd204eef3
Successfully built gast
Installing collected packages: tensorflow-estimator, tensorboard, keras-applications, gast, tensorflow
  Attempting uninstall: tensorflow-estimator
    Found existing installation: tensorflow-estimator 2.8.0
    Uninstalling tensorflow-estimator-2.8.0:
      Successfully uninstalled tensorflow-estimator-2.8.0
  Attempting uninstall: tensorboard
    Found existing installation: tensorboard 2.8.0
    Uninstalling tensorboard-2.8.0:
      Successfully uninstalled tensorboard-2.8.0
  Attempting uninstall: gast
    Found existing installation: gast 0.5.3
    Uninstalling gast-0.5.3:
      Successfully uninstalled gast-0.5.3
  Attempting uninstall: tensorflow
    Found existing installation: tensorflow 2.8.0
    Uninstalling tensorflow-2.8.0:
      Successfully uninstalled tensorflow-2.8.0
[31mERROR: pip&#39;s dependency resolver does not currently take into account all the packages that are installed. This behaviour is the source of the following dependency conflicts.
tensorflow-probability 0.16.0 requires gast&gt;=0.3.2, but you have gast 0.2.2 which is incompatible.
kapre 0.3.7 requires tensorflow&gt;=2.0.0, but you have tensorflow 1.15.0 which is incompatible.[0m
Successfully installed gast-0.2.2 keras-applications-1.0.8 tensorboard-1.15.0 tensorflow-1.15.0 tensorflow-estimator-1.15.1
</code></pre></div>

<p>install baselines from openAI</p>
<div class="codehilite"><pre><span></span><code><span class="err">!</span><span class="n">apt</span><span class="o">-</span><span class="n">get</span> <span class="n">update</span>
<span class="err">!</span><span class="n">apt</span><span class="o">-</span><span class="n">get</span> <span class="n">install</span> <span class="o">-</span><span class="n">y</span> <span class="n">cmake</span> <span class="n">libopenmpi</span><span class="o">-</span><span class="n">dev</span> <span class="n">python3</span><span class="o">-</span><span class="n">dev</span> <span class="n">zlib1g</span><span class="o">-</span><span class="n">dev</span>
<span class="err">!</span><span class="n">pip</span> <span class="n">install</span> <span class="s2">&quot;stable-baselines[mpi]==2.9.0&quot;</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code>Get:1 https://cloud.r-project.org/bin/linux/ubuntu bionic-cran40/ InRelease [3,626 B]
Ign:2 https://developer.download.nvidia.com/compute/cuda/repos/ubuntu1804/x86_64  InRelease
Get:3 http://security.ubuntu.com/ubuntu bionic-security InRelease [88.7 kB]    
Ign:4 https://developer.download.nvidia.com/compute/machine-learning/repos/ubuntu1804/x86_64  InRelease
Get:5 https://developer.download.nvidia.com/compute/cuda/repos/ubuntu1804/x86_64  Release [696 B]
Hit:6 https://developer.download.nvidia.com/compute/machine-learning/repos/ubuntu1804/x86_64  Release
Get:7 https://developer.download.nvidia.com/compute/cuda/repos/ubuntu1804/x86_64  Release.gpg [836 B]
Get:8 http://ppa.launchpad.net/c2d4u.team/c2d4u4.0+/ubuntu bionic InRelease [15.9 kB]
Hit:9 http://archive.ubuntu.com/ubuntu bionic InRelease
Get:10 http://archive.ubuntu.com/ubuntu bionic-updates InRelease [88.7 kB]
Hit:11 http://ppa.launchpad.net/cran/libgit2/ubuntu bionic InRelease
Get:13 http://archive.ubuntu.com/ubuntu bionic-backports InRelease [74.6 kB]
Get:14 https://developer.download.nvidia.com/compute/cuda/repos/ubuntu1804/x86_64  Packages [930 kB]
Hit:15 http://ppa.launchpad.net/deadsnakes/ppa/ubuntu bionic InRelease
Get:16 http://ppa.launchpad.net/graphics-drivers/ppa/ubuntu bionic InRelease [21.3 kB]
Get:17 http://security.ubuntu.com/ubuntu bionic-security/restricted amd64 Packages [806 kB]
Get:18 http://security.ubuntu.com/ubuntu bionic-security/universe amd64 Packages [1,474 kB]
Get:19 http://security.ubuntu.com/ubuntu bionic-security/main amd64 Packages [2,596 kB]
Get:20 http://ppa.launchpad.net/c2d4u.team/c2d4u4.0+/ubuntu bionic/main Sources [1,827 kB]
Get:21 http://archive.ubuntu.com/ubuntu bionic-updates/main amd64 Packages [3,035 kB]
Get:22 http://ppa.launchpad.net/c2d4u.team/c2d4u4.0+/ubuntu bionic/main amd64 Packages [937 kB]
Get:23 http://archive.ubuntu.com/ubuntu bionic-updates/universe amd64 Packages [2,252 kB]
Get:24 http://archive.ubuntu.com/ubuntu bionic-updates/restricted amd64 Packages [840 kB]
Get:25 http://ppa.launchpad.net/graphics-drivers/ppa/ubuntu bionic/main amd64 Packages [42.8 kB]
Fetched 15.0 MB in 5s (2,992 kB/s)
Reading package lists... Done
Reading package lists... Done
Building dependency tree       
Reading state information... Done
zlib1g-dev is already the newest version (1:1.2.11.dfsg-0ubuntu2).
zlib1g-dev set to manually installed.
libopenmpi-dev is already the newest version (2.1.1-8).
cmake is already the newest version (3.10.2-1ubuntu2.18.04.2).
python3-dev is already the newest version (3.6.7-1~18.04).
python3-dev set to manually installed.
The following package was automatically installed and is no longer required:
  libnvidia-common-470
Use &#39;apt autoremove&#39; to remove it.
0 upgraded, 0 newly installed, 0 to remove and 67 not upgraded.
Collecting stable-baselines[mpi]==2.9.0
  Downloading stable_baselines-2.9.0-py3-none-any.whl (232 kB)
[K     |████████████████████████████████| 232 kB 7.3 MB/s 
[?25hRequirement already satisfied: matplotlib in /usr/local/lib/python3.7/dist-packages (from stable-baselines[mpi]==2.9.0) (3.2.2)
Requirement already satisfied: pandas in /usr/local/lib/python3.7/dist-packages (from stable-baselines[mpi]==2.9.0) (1.3.5)
Requirement already satisfied: scipy in /usr/local/lib/python3.7/dist-packages (from stable-baselines[mpi]==2.9.0) (1.4.1)
Requirement already satisfied: opencv-python in /usr/local/lib/python3.7/dist-packages (from stable-baselines[mpi]==2.9.0) (4.1.2.30)
Requirement already satisfied: joblib in /usr/local/lib/python3.7/dist-packages (from stable-baselines[mpi]==2.9.0) (1.1.0)
Requirement already satisfied: gym[atari,classic_control]&gt;=0.10.9 in /usr/local/lib/python3.7/dist-packages (from stable-baselines[mpi]==2.9.0) (0.17.3)
Requirement already satisfied: cloudpickle&gt;=0.5.5 in /usr/local/lib/python3.7/dist-packages (from stable-baselines[mpi]==2.9.0) (1.3.0)
Requirement already satisfied: numpy in /usr/local/lib/python3.7/dist-packages (from stable-baselines[mpi]==2.9.0) (1.21.5)
Collecting mpi4py
  Downloading mpi4py-3.1.3.tar.gz (2.5 MB)
[K     |████████████████████████████████| 2.5 MB 17.1 MB/s 
[?25h  Installing build dependencies ... [?25l[?25hdone
  Getting requirements to build wheel ... [?25l[?25hdone
    Preparing wheel metadata ... [?25l[?25hdone
Requirement already satisfied: pyglet&lt;=1.5.0,&gt;=1.4.0 in /usr/local/lib/python3.7/dist-packages (from gym[atari,classic_control]&gt;=0.10.9-&gt;stable-baselines[mpi]==2.9.0) (1.5.0)
Requirement already satisfied: Pillow in /usr/local/lib/python3.7/dist-packages (from gym[atari,classic_control]&gt;=0.10.9-&gt;stable-baselines[mpi]==2.9.0) (7.1.2)
Requirement already satisfied: atari-py~=0.2.0 in /usr/local/lib/python3.7/dist-packages (from gym[atari,classic_control]&gt;=0.10.9-&gt;stable-baselines[mpi]==2.9.0) (0.2.9)
Requirement already satisfied: six in /usr/local/lib/python3.7/dist-packages (from atari-py~=0.2.0-&gt;gym[atari,classic_control]&gt;=0.10.9-&gt;stable-baselines[mpi]==2.9.0) (1.15.0)
Requirement already satisfied: future in /usr/local/lib/python3.7/dist-packages (from pyglet&lt;=1.5.0,&gt;=1.4.0-&gt;gym[atari,classic_control]&gt;=0.10.9-&gt;stable-baselines[mpi]==2.9.0) (0.16.0)
Requirement already satisfied: pyparsing!=2.0.4,!=2.1.2,!=2.1.6,&gt;=2.0.1 in /usr/local/lib/python3.7/dist-packages (from matplotlib-&gt;stable-baselines[mpi]==2.9.0) (3.0.7)
Requirement already satisfied: cycler&gt;=0.10 in /usr/local/lib/python3.7/dist-packages (from matplotlib-&gt;stable-baselines[mpi]==2.9.0) (0.11.0)
Requirement already satisfied: kiwisolver&gt;=1.0.1 in /usr/local/lib/python3.7/dist-packages (from matplotlib-&gt;stable-baselines[mpi]==2.9.0) (1.3.2)
Requirement already satisfied: python-dateutil&gt;=2.1 in /usr/local/lib/python3.7/dist-packages (from matplotlib-&gt;stable-baselines[mpi]==2.9.0) (2.8.2)
Requirement already satisfied: pytz&gt;=2017.3 in /usr/local/lib/python3.7/dist-packages (from pandas-&gt;stable-baselines[mpi]==2.9.0) (2018.9)
Building wheels for collected packages: mpi4py
  Building wheel for mpi4py (PEP 517) ... [?25l[?25hdone
  Created wheel for mpi4py: filename=mpi4py-3.1.3-cp37-cp37m-linux_x86_64.whl size=2185292 sha256=201eb8ee46e6f84a098ad3d83af5413f76be954aab911419894bec8346068c61
  Stored in directory: /root/.cache/pip/wheels/7a/07/14/6a0c63fa2c6e473c6edc40985b7d89f05c61ff25ee7f0ad9ac
Successfully built mpi4py
Installing collected packages: stable-baselines, mpi4py
Successfully installed mpi4py-3.1.3 stable-baselines-2.9.0
</code></pre></div>

<div class="codehilite"><pre><span></span><code><span class="c1"># Check version of tensorflow</span>
<span class="kn">import</span> <span class="nn">tensorflow</span> <span class="k">as</span> <span class="nn">tf</span>
<span class="n">tf</span><span class="o">.</span><span class="n">__version__</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code>&#39;1.15.0&#39;
</code></pre></div>

<div class="codehilite"><pre><span></span><code><span class="kn">from</span> <span class="nn">gym</span> <span class="kn">import</span> <span class="n">spaces</span>
<span class="kn">import</span> <span class="nn">gym</span>
<span class="kn">from</span> <span class="nn">stable_baselines.common.env_checker</span> <span class="kn">import</span> <span class="n">check_env</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code>WARNING:tensorflow:
The TensorFlow contrib module will not be included in TensorFlow 2.0.
For more information, please see:
  * https://github.com/tensorflow/community/blob/master/rfcs/20180907-contrib-sunset.md
  * https://github.com/tensorflow/addons
  * https://github.com/tensorflow/io (for I/O related ops)
If you depend on functionality not listed there, please file an issue.
</code></pre></div>

<div class="codehilite"><pre><span></span><code><span class="kn">import</span> <span class="nn">random</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="k">def</span> <span class="nf">n_step_ai</span><span class="p">(</span><span class="n">board</span><span class="p">,</span> <span class="n">win_patterns</span><span class="p">,</span> <span class="n">player_label</span><span class="p">,</span> <span class="n">n_steps</span><span class="o">=</span><span class="mi">3</span><span class="p">):</span>
  <span class="n">opponent</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">,</span> <span class="s1">&#39;O&#39;</span><span class="p">]</span>
  <span class="n">opponent</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">player_label</span><span class="p">)</span>
  <span class="n">opponent</span> <span class="o">=</span> <span class="n">opponent</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

  <span class="n">avail_moves</span> <span class="o">=</span> <span class="p">{</span><span class="n">i</span><span class="p">:</span> <span class="mi">1</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">board</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="k">if</span> <span class="n">board</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39; &#39;</span><span class="p">}</span>

  <span class="k">for</span> <span class="n">move</span> <span class="ow">in</span> <span class="n">avail_moves</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
    <span class="n">temp_board</span> <span class="o">=</span> <span class="n">board</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">temp_board</span><span class="p">[</span><span class="n">move</span><span class="p">]</span> <span class="o">=</span> <span class="n">player_label</span>
    <span class="n">score</span> <span class="o">=</span> <span class="n">get_minimax</span><span class="p">(</span><span class="n">n_steps</span><span class="p">,</span> <span class="n">temp_board</span><span class="p">,</span> <span class="n">player_label</span><span class="p">)</span>
    <span class="n">avail_moves</span><span class="p">[</span><span class="n">move</span><span class="p">]</span> <span class="o">=</span> <span class="n">score</span>

  <span class="c1">##########################################</span>
  <span class="c1">### The rest of our ai agent harness is the same</span>
  <span class="c1">##########################################</span>

  <span class="c1"># first grab max score</span>
  <span class="n">max_score</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">avail_moves</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>

  <span class="c1"># then select all moves that have this max score</span>
  <span class="n">valid</span> <span class="o">=</span> <span class="p">[]</span>
  <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">avail_moves</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="k">if</span> <span class="n">value</span> <span class="o">==</span> <span class="n">max_score</span><span class="p">:</span>
      <span class="n">valid</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>

  <span class="c1"># return a random selection of the moves with the max score</span>
  <span class="n">move</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">valid</span><span class="p">)</span>

  <span class="k">return</span> <span class="n">move</span>

<span class="k">def</span> <span class="nf">minimax</span><span class="p">(</span><span class="n">depth</span><span class="p">,</span> <span class="n">board</span><span class="p">,</span> <span class="n">maximizing_player</span><span class="p">,</span> <span class="n">player_label</span><span class="p">,</span> <span class="n">verbiose</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
  <span class="c1"># infer the opponent</span>
  <span class="n">opponent</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">,</span> <span class="s1">&#39;O&#39;</span><span class="p">]</span>
  <span class="n">opponent</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">player_label</span><span class="p">)</span>
  <span class="n">opponent</span> <span class="o">=</span> <span class="n">opponent</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

  <span class="c1"># set the available moves</span>
  <span class="n">avail_moves</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">board</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="k">if</span> <span class="n">board</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39; &#39;</span><span class="p">]</span>

  <span class="c1"># check if the depth is 0, or stalemate/winner has been reached</span>
  <span class="c1"># if so this is the basecase and we want to return get_score()</span>
  <span class="n">terminal_move</span> <span class="o">=</span> <span class="n">is_terminal_node</span><span class="p">(</span><span class="n">board</span><span class="p">,</span> <span class="n">avail_moves</span><span class="p">)</span>

  <span class="k">if</span> <span class="n">terminal_move</span> <span class="ow">or</span> <span class="n">depth</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
    <span class="n">score</span> <span class="o">=</span> <span class="n">get_score</span><span class="p">(</span><span class="n">board</span><span class="p">,</span> <span class="n">player_label</span><span class="p">,</span> <span class="n">win_patterns</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">verbiose</span><span class="p">:</span>
      <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1"> score: </span><span class="si">{}</span><span class="s1">. depth: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">board</span><span class="p">,</span> <span class="n">score</span><span class="p">,</span> <span class="n">depth</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">score</span>

  <span class="c1">### in the following we want to search through every possible board at the </span>
  <span class="c1">### current level (the possible moves for the current player, given that the</span>
  <span class="c1">### player is either the one whose turn it is or the imagined opponent)</span>

  <span class="c1"># call minimax where it is the current players turn and so we want to </span>
  <span class="c1"># maximize the score</span>
  <span class="k">if</span> <span class="n">maximizing_player</span><span class="p">:</span>
    <span class="n">score</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">Inf</span>
    <span class="k">for</span> <span class="n">move</span> <span class="ow">in</span> <span class="n">avail_moves</span><span class="p">:</span>
      <span class="n">new_board</span> <span class="o">=</span> <span class="n">board</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
      <span class="n">new_board</span><span class="p">[</span><span class="n">move</span><span class="p">]</span> <span class="o">=</span> <span class="n">player_label</span>
      <span class="n">score</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">score</span><span class="p">,</span> <span class="n">minimax</span><span class="p">(</span><span class="n">depth</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">new_board</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="n">player_label</span><span class="p">,</span> <span class="n">verbiose</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">verbiose</span><span class="p">:</span>
      <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1"> max. score: </span><span class="si">{}</span><span class="s1">. depth: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">board</span><span class="p">,</span> <span class="n">score</span><span class="p">,</span> <span class="n">depth</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">score</span>

  <span class="c1"># call minimax where it is the opponent players turn and so we want to</span>
  <span class="c1"># minimize the score</span>
  <span class="k">elif</span> <span class="ow">not</span> <span class="n">maximizing_player</span><span class="p">:</span>
    <span class="n">score</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">Inf</span>
    <span class="k">for</span> <span class="n">move</span> <span class="ow">in</span> <span class="n">avail_moves</span><span class="p">:</span>
      <span class="n">new_board</span> <span class="o">=</span> <span class="n">board</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
      <span class="n">new_board</span><span class="p">[</span><span class="n">move</span><span class="p">]</span> <span class="o">=</span> <span class="n">opponent</span>
      <span class="n">score</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">score</span><span class="p">,</span> <span class="n">minimax</span><span class="p">(</span><span class="n">depth</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">new_board</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="n">player_label</span><span class="p">,</span> <span class="n">verbiose</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">verbiose</span><span class="p">:</span>
      <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1"> min. score: </span><span class="si">{}</span><span class="s1">. depth: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">board</span><span class="p">,</span> <span class="n">score</span><span class="p">,</span> <span class="n">depth</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">score</span>

<span class="k">def</span> <span class="nf">is_terminal_node</span><span class="p">(</span><span class="n">board</span><span class="p">,</span> <span class="n">avail_moves</span><span class="p">):</span>
  <span class="k">if</span> <span class="n">check_winning</span><span class="p">(</span><span class="n">board</span><span class="p">,</span> <span class="n">win_patterns</span><span class="p">):</span>
    <span class="k">return</span> <span class="kc">True</span>
  <span class="k">elif</span> <span class="n">check_stalemate</span><span class="p">(</span><span class="n">board</span><span class="p">,</span> <span class="n">win_patterns</span><span class="p">):</span>
    <span class="k">return</span> <span class="kc">True</span>
  <span class="k">else</span><span class="p">:</span>
    <span class="k">return</span> <span class="kc">False</span>

<span class="k">def</span> <span class="nf">get_score</span><span class="p">(</span><span class="n">board</span><span class="p">,</span> <span class="n">player_label</span><span class="p">,</span> <span class="n">win_patterns</span><span class="p">):</span>
  <span class="c1"># this will look somewhat similar to our 1-step lookahead algorithm</span>
  <span class="n">opponent</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">,</span> <span class="s1">&#39;O&#39;</span><span class="p">]</span>
  <span class="n">opponent</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">player_label</span><span class="p">)</span>
  <span class="n">opponent</span> <span class="o">=</span> <span class="n">opponent</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
  <span class="n">score</span> <span class="o">=</span> <span class="mi">0</span>
  <span class="k">for</span> <span class="n">pattern</span> <span class="ow">in</span> <span class="n">win_patterns</span><span class="p">:</span>
      <span class="n">values</span> <span class="o">=</span> <span class="p">[</span><span class="n">board</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">pattern</span><span class="p">]</span> 
      <span class="c1"># if the opponent wins, the score is -100</span>
      <span class="k">if</span> <span class="n">values</span> <span class="o">==</span> <span class="p">[</span><span class="n">opponent</span><span class="p">,</span> <span class="n">opponent</span><span class="p">,</span> <span class="n">opponent</span><span class="p">]:</span>
        <span class="n">score</span> <span class="o">=</span> <span class="o">-</span><span class="mi">100</span>
      <span class="k">elif</span> <span class="n">values</span> <span class="o">==</span> <span class="p">[</span><span class="n">player_label</span><span class="p">,</span> <span class="n">player_label</span><span class="p">,</span> <span class="n">player_label</span><span class="p">]:</span>
        <span class="n">score</span> <span class="o">=</span> <span class="mi">100</span>
  <span class="k">return</span> <span class="n">score</span>

<span class="c1"># we&#39;re going to pull out and reformat some of our helper functions in the</span>
<span class="c1"># TicTacToe class</span>

<span class="n">win_patterns</span> <span class="o">=</span> <span class="p">[[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">],</span> <span class="p">[</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">],</span> <span class="p">[</span><span class="mi">7</span><span class="p">,</span><span class="mi">8</span><span class="p">,</span><span class="mi">9</span><span class="p">],</span>
                <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">7</span><span class="p">],</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">8</span><span class="p">],</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">9</span><span class="p">],</span>
                <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">9</span><span class="p">],</span> <span class="p">[</span><span class="mi">7</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">3</span><span class="p">]]</span>

<span class="k">def</span> <span class="nf">check_winning</span><span class="p">(</span><span class="n">board</span><span class="p">,</span> <span class="n">win_patterns</span><span class="p">):</span>
  <span class="k">for</span> <span class="n">pattern</span> <span class="ow">in</span> <span class="n">win_patterns</span><span class="p">:</span>
    <span class="n">values</span> <span class="o">=</span> <span class="p">[</span><span class="n">board</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">pattern</span><span class="p">]</span> 
    <span class="k">if</span> <span class="n">values</span> <span class="o">==</span> <span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">,</span> <span class="s1">&#39;X&#39;</span><span class="p">,</span> <span class="s1">&#39;X&#39;</span><span class="p">]</span> <span class="ow">or</span> <span class="n">values</span> <span class="o">==</span> <span class="p">[</span><span class="s1">&#39;O&#39;</span><span class="p">,</span> <span class="s1">&#39;O&#39;</span><span class="p">,</span> <span class="s1">&#39;O&#39;</span><span class="p">]:</span>
      <span class="k">return</span> <span class="kc">True</span>
  <span class="k">return</span> <span class="kc">False</span>

<span class="k">def</span> <span class="nf">check_stalemate</span><span class="p">(</span><span class="n">board</span><span class="p">,</span> <span class="n">win_patterns</span><span class="p">):</span>
  <span class="k">if</span> <span class="p">(</span><span class="s1">&#39; &#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">board</span><span class="o">.</span><span class="n">values</span><span class="p">())</span> <span class="ow">and</span> <span class="p">(</span><span class="n">check_winning</span><span class="p">(</span><span class="n">board</span><span class="p">,</span> <span class="n">win_patterns</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">):</span>
    <span class="k">return</span> <span class="kc">True</span>
  <span class="k">return</span> <span class="kc">False</span>

<span class="k">def</span> <span class="nf">get_minimax</span><span class="p">(</span><span class="n">depth</span><span class="p">,</span> <span class="n">board</span><span class="p">,</span> <span class="n">player_label</span><span class="p">,</span> <span class="n">verbiose</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
  <span class="n">score</span> <span class="o">=</span> <span class="n">minimax</span><span class="p">(</span><span class="n">depth</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">board</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="n">player_label</span><span class="p">,</span> <span class="n">verbiose</span><span class="o">=</span><span class="n">verbiose</span><span class="p">)</span>
  <span class="k">return</span> <span class="n">score</span>

<span class="k">def</span> <span class="nf">n_step_ai_temp</span><span class="p">(</span><span class="n">board</span><span class="p">,</span> <span class="n">win_patterns</span><span class="p">,</span> <span class="n">player_label</span><span class="p">,</span> <span class="n">n_steps</span><span class="p">,</span> <span class="n">verbiose</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
  <span class="n">opponent</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">,</span> <span class="s1">&#39;O&#39;</span><span class="p">]</span>
  <span class="n">opponent</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">player_label</span><span class="p">)</span>
  <span class="n">opponent</span> <span class="o">=</span> <span class="n">opponent</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

  <span class="n">avail_moves</span> <span class="o">=</span> <span class="p">{</span><span class="n">i</span><span class="p">:</span> <span class="mi">1</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">board</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="k">if</span> <span class="n">board</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39; &#39;</span><span class="p">}</span>

  <span class="k">for</span> <span class="n">move</span> <span class="ow">in</span> <span class="n">avail_moves</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
    <span class="n">temp_board</span> <span class="o">=</span> <span class="n">board</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">temp_board</span><span class="p">[</span><span class="n">move</span><span class="p">]</span> <span class="o">=</span> <span class="n">player_label</span>
    <span class="n">score</span> <span class="o">=</span> <span class="n">get_minimax</span><span class="p">(</span><span class="n">n_steps</span><span class="p">,</span> <span class="n">temp_board</span><span class="p">,</span> <span class="n">player_label</span><span class="p">,</span> <span class="n">verbiose</span><span class="o">=</span><span class="n">verbiose</span><span class="p">)</span>
    <span class="n">avail_moves</span><span class="p">[</span><span class="n">move</span><span class="p">]</span> <span class="o">=</span> <span class="n">score</span>
  <span class="k">return</span> <span class="n">avail_moves</span>

<span class="k">def</span> <span class="nf">one_step_ai</span><span class="p">(</span><span class="n">board</span><span class="p">,</span> <span class="n">win_patterns</span><span class="p">,</span> <span class="n">player_label</span><span class="p">):</span>
  <span class="n">opponent</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">,</span> <span class="s1">&#39;O&#39;</span><span class="p">]</span>
  <span class="n">opponent</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">player_label</span><span class="p">)</span>
  <span class="n">opponent</span> <span class="o">=</span> <span class="n">opponent</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

  <span class="n">avail_moves</span> <span class="o">=</span> <span class="p">{</span><span class="n">i</span><span class="p">:</span> <span class="mi">1</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">board</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="k">if</span> <span class="n">board</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39; &#39;</span><span class="p">}</span>
  <span class="n">temp_board</span> <span class="o">=</span> <span class="n">board</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
  <span class="c1">########################################</span>
  <span class="c1"># we&#39;re going to change the following lines, instead of caring</span>
  <span class="c1"># whether we&#39;ve found the best move, we want to update the move</span>
  <span class="c1"># with a score</span>
  <span class="c1">########################################</span>

  <span class="c1"># check if the opponent has a winning move first, we will overwrite</span>
  <span class="c1"># the score for this move if it is also a winning move for the current </span>
  <span class="c1"># player</span>
  <span class="k">for</span> <span class="n">move</span> <span class="ow">in</span> <span class="n">avail_moves</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
    <span class="n">temp_board</span><span class="p">[</span><span class="n">move</span><span class="p">]</span> <span class="o">=</span> <span class="n">opponent</span>
    <span class="k">for</span> <span class="n">pattern</span> <span class="ow">in</span> <span class="n">win_patterns</span><span class="p">:</span>
        <span class="n">values</span> <span class="o">=</span> <span class="p">[</span><span class="n">temp_board</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">pattern</span><span class="p">]</span> 
        <span class="k">if</span> <span class="n">values</span> <span class="o">==</span> <span class="p">[</span><span class="n">opponent</span><span class="p">,</span> <span class="n">opponent</span><span class="p">,</span> <span class="n">opponent</span><span class="p">]:</span>
          <span class="n">avail_moves</span><span class="p">[</span><span class="n">move</span><span class="p">]</span> <span class="o">=</span> <span class="mi">10</span>
    <span class="n">temp_board</span><span class="p">[</span><span class="n">move</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39; &#39;</span>

  <span class="k">for</span> <span class="n">move</span> <span class="ow">in</span> <span class="n">avail_moves</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
    <span class="n">temp_board</span><span class="p">[</span><span class="n">move</span><span class="p">]</span> <span class="o">=</span> <span class="n">player_label</span>
    <span class="k">for</span> <span class="n">pattern</span> <span class="ow">in</span> <span class="n">win_patterns</span><span class="p">:</span>
        <span class="n">values</span> <span class="o">=</span> <span class="p">[</span><span class="n">temp_board</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">pattern</span><span class="p">]</span> 
        <span class="k">if</span> <span class="n">values</span> <span class="o">==</span> <span class="p">[</span><span class="n">player_label</span><span class="p">,</span> <span class="n">player_label</span><span class="p">,</span> <span class="n">player_label</span><span class="p">]:</span>
          <span class="n">avail_moves</span><span class="p">[</span><span class="n">move</span><span class="p">]</span> <span class="o">=</span> <span class="mi">100</span>
    <span class="n">temp_board</span><span class="p">[</span><span class="n">move</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39; &#39;</span>

  <span class="c1"># first grab max score</span>
  <span class="n">max_score</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">avail_moves</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>

  <span class="c1"># then select all moves that have this max score</span>
  <span class="n">valid</span> <span class="o">=</span> <span class="p">[]</span>
  <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">avail_moves</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="k">if</span> <span class="n">value</span> <span class="o">==</span> <span class="n">max_score</span><span class="p">:</span>
      <span class="n">valid</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>

  <span class="c1"># return a random selection of the moves with the max score</span>
  <span class="n">move</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">valid</span><span class="p">)</span>

  <span class="k">return</span> <span class="n">move</span>

<span class="k">class</span> <span class="nc">TicTacToe</span><span class="p">:</span>
  <span class="c1"># can preset winner and starting player</span>
  <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">winner</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">start_player</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">):</span> 
    <span class="bp">self</span><span class="o">.</span><span class="n">winner</span> <span class="o">=</span> <span class="n">winner</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">start_player</span> <span class="o">=</span> <span class="n">start_player</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">board</span> <span class="o">=</span> <span class="p">{</span><span class="mi">1</span><span class="p">:</span> <span class="s1">&#39; &#39;</span><span class="p">,</span>
         <span class="mi">2</span><span class="p">:</span> <span class="s1">&#39; &#39;</span><span class="p">,</span>
         <span class="mi">3</span><span class="p">:</span> <span class="s1">&#39; &#39;</span><span class="p">,</span>
         <span class="mi">4</span><span class="p">:</span> <span class="s1">&#39; &#39;</span><span class="p">,</span>
         <span class="mi">5</span><span class="p">:</span> <span class="s1">&#39; &#39;</span><span class="p">,</span>
         <span class="mi">6</span><span class="p">:</span> <span class="s1">&#39; &#39;</span><span class="p">,</span>
         <span class="mi">7</span><span class="p">:</span> <span class="s1">&#39; &#39;</span><span class="p">,</span>
         <span class="mi">8</span><span class="p">:</span> <span class="s1">&#39; &#39;</span><span class="p">,</span>
         <span class="mi">9</span><span class="p">:</span> <span class="s1">&#39; &#39;</span><span class="p">,}</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">win_patterns</span> <span class="o">=</span> <span class="p">[[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">],</span> <span class="p">[</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">],</span> <span class="p">[</span><span class="mi">7</span><span class="p">,</span><span class="mi">8</span><span class="p">,</span><span class="mi">9</span><span class="p">],</span>
                <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">7</span><span class="p">],</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">8</span><span class="p">],</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">9</span><span class="p">],</span>
                <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">9</span><span class="p">],</span> <span class="p">[</span><span class="mi">7</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">3</span><span class="p">]]</span>

  <span class="c1"># the other functions are now passed self</span>
  <span class="k">def</span> <span class="nf">visualize_board</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span>
      <span class="s2">&quot;|</span><span class="si">{}</span><span class="s2">|</span><span class="si">{}</span><span class="s2">|</span><span class="si">{}</span><span class="s2">|</span><span class="se">\n</span><span class="s2">|</span><span class="si">{}</span><span class="s2">|</span><span class="si">{}</span><span class="s2">|</span><span class="si">{}</span><span class="s2">|</span><span class="se">\n</span><span class="s2">|</span><span class="si">{}</span><span class="s2">|</span><span class="si">{}</span><span class="s2">|</span><span class="si">{}</span><span class="s2">|</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">board</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
      <span class="p">)</span>

  <span class="k">def</span> <span class="nf">check_winning</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">pattern</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">win_patterns</span><span class="p">:</span>
      <span class="n">values</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">board</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">pattern</span><span class="p">]</span> 
      <span class="k">if</span> <span class="n">values</span> <span class="o">==</span> <span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">,</span> <span class="s1">&#39;X&#39;</span><span class="p">,</span> <span class="s1">&#39;X&#39;</span><span class="p">]:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">winner</span> <span class="o">=</span> <span class="s1">&#39;X&#39;</span> <span class="c1"># we update the winner status</span>
        <span class="k">return</span> <span class="s2">&quot;&#39;X&#39; Won!&quot;</span>
      <span class="k">elif</span> <span class="n">values</span> <span class="o">==</span> <span class="p">[</span><span class="s1">&#39;O&#39;</span><span class="p">,</span> <span class="s1">&#39;O&#39;</span><span class="p">,</span> <span class="s1">&#39;O&#39;</span><span class="p">]:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">winner</span> <span class="o">=</span> <span class="s1">&#39;O&#39;</span>
        <span class="k">return</span> <span class="s2">&quot;&#39;O&#39; Won!&quot;</span>
    <span class="k">return</span> <span class="s1">&#39;&#39;</span>

  <span class="k">def</span> <span class="nf">check_stalemate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">if</span> <span class="p">(</span><span class="s1">&#39; &#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">board</span><span class="o">.</span><span class="n">values</span><span class="p">())</span> <span class="ow">and</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">check_winning</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">):</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">winner</span> <span class="o">=</span> <span class="s1">&#39;Stalemate&#39;</span>
      <span class="k">return</span> <span class="s2">&quot;It&#39;s a stalemate!&quot;</span>

<span class="k">class</span> <span class="nc">GameEngine</span><span class="p">(</span><span class="n">TicTacToe</span><span class="p">):</span>
  <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">setup</span><span class="o">=</span><span class="s1">&#39;auto&#39;</span><span class="p">,</span> <span class="n">user_ai</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">setup</span> <span class="o">=</span> <span class="n">setup</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">user_ai</span> <span class="o">=</span> <span class="n">user_ai</span>

  <span class="k">def</span> <span class="nf">heuristic_ai</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">player_label</span><span class="p">):</span>
    <span class="n">opponent</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">,</span> <span class="s1">&#39;O&#39;</span><span class="p">]</span>
    <span class="n">opponent</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">player_label</span><span class="p">)</span>
    <span class="n">opponent</span> <span class="o">=</span> <span class="n">opponent</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

    <span class="n">avail_moves</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">board</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">board</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39; &#39;</span><span class="p">]</span>
    <span class="n">temp_board</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">board</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">middle</span> <span class="o">=</span> <span class="mi">5</span>
    <span class="n">corner</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="mi">9</span><span class="p">]</span>
    <span class="n">side</span> <span class="o">=</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">8</span><span class="p">]</span>

    <span class="c1"># first check for a winning move</span>
    <span class="n">move_found</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">for</span> <span class="n">move</span> <span class="ow">in</span> <span class="n">avail_moves</span><span class="p">:</span>
      <span class="n">temp_board</span><span class="p">[</span><span class="n">move</span><span class="p">]</span> <span class="o">=</span> <span class="n">player_label</span>
      <span class="k">for</span> <span class="n">pattern</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">win_patterns</span><span class="p">:</span>
          <span class="n">values</span> <span class="o">=</span> <span class="p">[</span><span class="n">temp_board</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">pattern</span><span class="p">]</span> 
          <span class="k">if</span> <span class="n">values</span> <span class="o">==</span> <span class="p">[</span><span class="n">player_label</span><span class="p">,</span> <span class="n">player_label</span><span class="p">,</span> <span class="n">player_label</span><span class="p">]:</span>
            <span class="n">move_found</span> <span class="o">=</span> <span class="kc">True</span>       
            <span class="k">break</span>
      <span class="k">if</span> <span class="n">move_found</span><span class="p">:</span>   
        <span class="k">break</span>
      <span class="k">else</span><span class="p">:</span>
        <span class="n">temp_board</span><span class="p">[</span><span class="n">move</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39; &#39;</span>

    <span class="c1"># check if the opponent has a winning move</span>
    <span class="k">if</span> <span class="n">move_found</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
      <span class="k">for</span> <span class="n">move</span> <span class="ow">in</span> <span class="n">avail_moves</span><span class="p">:</span>
        <span class="n">temp_board</span><span class="p">[</span><span class="n">move</span><span class="p">]</span> <span class="o">=</span> <span class="n">opponent</span>
        <span class="k">for</span> <span class="n">pattern</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">win_patterns</span><span class="p">:</span>
            <span class="n">values</span> <span class="o">=</span> <span class="p">[</span><span class="n">temp_board</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">pattern</span><span class="p">]</span> 
            <span class="k">if</span> <span class="n">values</span> <span class="o">==</span> <span class="p">[</span><span class="n">opponent</span><span class="p">,</span> <span class="n">opponent</span><span class="p">,</span> <span class="n">opponent</span><span class="p">]:</span>
              <span class="n">move_found</span> <span class="o">=</span> <span class="kc">True</span>       
              <span class="k">break</span>
        <span class="k">if</span> <span class="n">move_found</span><span class="p">:</span>   
          <span class="k">break</span>
        <span class="k">else</span><span class="p">:</span>
          <span class="n">temp_board</span><span class="p">[</span><span class="n">move</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39; &#39;</span>

    <span class="c1"># check if middle avail</span>
    <span class="k">if</span> <span class="n">move_found</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
      <span class="k">if</span> <span class="n">middle</span> <span class="ow">in</span> <span class="n">avail_moves</span><span class="p">:</span>
        <span class="n">move_found</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">move</span> <span class="o">=</span> <span class="n">middle</span>

    <span class="c1"># check corners</span>
    <span class="k">if</span> <span class="n">move_found</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
      <span class="n">move_corner</span> <span class="o">=</span> <span class="p">[</span><span class="n">val</span> <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">avail_moves</span> <span class="k">if</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">corner</span><span class="p">]</span>
      <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">move_corner</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">move</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">move_corner</span><span class="p">)</span>
        <span class="n">move_found</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="c1"># check side</span>
    <span class="k">if</span> <span class="n">move_found</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
      <span class="n">move_side</span> <span class="o">=</span> <span class="p">[</span><span class="n">val</span> <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">avail_moves</span> <span class="k">if</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">side</span><span class="p">]</span>
      <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">move_side</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">move</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">move_side</span><span class="p">)</span>
        <span class="n">move_found</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="k">return</span> <span class="n">move</span>

  <span class="k">def</span> <span class="nf">random_ai</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
      <span class="n">move</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">9</span><span class="p">)</span>
      <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">board</span><span class="p">[</span><span class="n">move</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39; &#39;</span><span class="p">:</span>
        <span class="k">continue</span>
      <span class="k">else</span><span class="p">:</span>
        <span class="k">break</span>
    <span class="k">return</span> <span class="n">move</span>

  <span class="k">def</span> <span class="nf">setup_game</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">setup</span> <span class="o">==</span> <span class="s1">&#39;user&#39;</span><span class="p">:</span>
      <span class="n">players</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">input</span><span class="p">(</span><span class="s2">&quot;How many Players? (type 0, 1, or 2)&quot;</span><span class="p">))</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">player_meta</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;first&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;label&#39;</span><span class="p">:</span> <span class="s1">&#39;X&#39;</span><span class="p">,</span>
                                    <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;ai&#39;</span><span class="p">},</span> 
                    <span class="s1">&#39;second&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;label&#39;</span><span class="p">:</span> <span class="s1">&#39;O&#39;</span><span class="p">,</span>
                                    <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;human&#39;</span><span class="p">}}</span>
      <span class="k">if</span> <span class="n">players</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">:</span>
        <span class="c1">########## </span>
        <span class="c1"># Allow the user to set the ai level</span>
        <span class="c1">########## </span>

        <span class="c1">### if they have not provided an ai_agent</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">user_ai</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
          <span class="n">level</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">input</span><span class="p">(</span><span class="s2">&quot;select AI level (1, 2)&quot;</span><span class="p">))</span>
          <span class="k">if</span> <span class="n">level</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ai_level</span> <span class="o">=</span> <span class="mi">1</span>
          <span class="k">elif</span> <span class="n">level</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ai_level</span> <span class="o">=</span> <span class="mi">2</span>
          <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Unknown AI level entered, this will cause problems&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
          <span class="bp">self</span><span class="o">.</span><span class="n">ai_level</span> <span class="o">=</span> <span class="mi">3</span>

      <span class="k">if</span> <span class="n">players</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">first</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s2">&quot;who will go first? (X, (AI), or O (Player))&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">first</span> <span class="o">==</span> <span class="s1">&#39;O&#39;</span><span class="p">:</span>
          <span class="bp">self</span><span class="o">.</span><span class="n">player_meta</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;second&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;label&#39;</span><span class="p">:</span> <span class="s1">&#39;X&#39;</span><span class="p">,</span>
                                    <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;ai&#39;</span><span class="p">},</span> 
                        <span class="s1">&#39;first&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;label&#39;</span><span class="p">:</span> <span class="s1">&#39;O&#39;</span><span class="p">,</span>
                                    <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;human&#39;</span><span class="p">}}</span>


      <span class="k">elif</span> <span class="n">players</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">first</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">([</span><span class="s1">&#39;X&#39;</span><span class="p">,</span> <span class="s1">&#39;O&#39;</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">first</span> <span class="o">==</span> <span class="s1">&#39;O&#39;</span><span class="p">:</span>
          <span class="bp">self</span><span class="o">.</span><span class="n">player_meta</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;second&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;label&#39;</span><span class="p">:</span> <span class="s1">&#39;X&#39;</span><span class="p">,</span>
                                    <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;ai&#39;</span><span class="p">},</span> 
                        <span class="s1">&#39;first&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;label&#39;</span><span class="p">:</span> <span class="s1">&#39;O&#39;</span><span class="p">,</span>
                                    <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;ai&#39;</span><span class="p">}}</span>                                
        <span class="k">else</span><span class="p">:</span>
          <span class="bp">self</span><span class="o">.</span><span class="n">player_meta</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;first&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;label&#39;</span><span class="p">:</span> <span class="s1">&#39;X&#39;</span><span class="p">,</span>
                                    <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;ai&#39;</span><span class="p">},</span> 
                        <span class="s1">&#39;second&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;label&#39;</span><span class="p">:</span> <span class="s1">&#39;O&#39;</span><span class="p">,</span>
                                    <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;ai&#39;</span><span class="p">}}</span>


    <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">setup</span> <span class="o">==</span> <span class="s1">&#39;auto&#39;</span><span class="p">:</span>
      <span class="n">first</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">([</span><span class="s1">&#39;X&#39;</span><span class="p">,</span> <span class="s1">&#39;O&#39;</span><span class="p">])</span>
      <span class="k">if</span> <span class="n">first</span> <span class="o">==</span> <span class="s1">&#39;O&#39;</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">start_player</span> <span class="o">=</span> <span class="s1">&#39;O&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">player_meta</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;second&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;label&#39;</span><span class="p">:</span> <span class="s1">&#39;X&#39;</span><span class="p">,</span>
                                  <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;ai&#39;</span><span class="p">},</span> 
                      <span class="s1">&#39;first&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;label&#39;</span><span class="p">:</span> <span class="s1">&#39;O&#39;</span><span class="p">,</span>
                                  <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;ai&#39;</span><span class="p">}}</span>                                
      <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">start_player</span> <span class="o">=</span> <span class="s1">&#39;X&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">player_meta</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;first&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;label&#39;</span><span class="p">:</span> <span class="s1">&#39;X&#39;</span><span class="p">,</span>
                                  <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;ai&#39;</span><span class="p">},</span> 
                      <span class="s1">&#39;second&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;label&#39;</span><span class="p">:</span> <span class="s1">&#39;O&#39;</span><span class="p">,</span>
                                  <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;ai&#39;</span><span class="p">}}</span>
      <span class="c1">########## </span>
      <span class="c1"># and automatically set the ai level otherwise</span>
      <span class="c1">##########  </span>
      <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">user_ai</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>                           
        <span class="bp">self</span><span class="o">.</span><span class="n">ai_level</span> <span class="o">=</span> <span class="mi">2</span>
      <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ai_level</span> <span class="o">=</span> <span class="mi">3</span>

  <span class="k">def</span> <span class="nf">play_game</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
      <span class="k">for</span> <span class="n">player</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;first&#39;</span><span class="p">,</span> <span class="s1">&#39;second&#39;</span><span class="p">]:</span>  
        <span class="bp">self</span><span class="o">.</span><span class="n">visualize_board</span><span class="p">()</span>
        <span class="n">player_label</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">player_meta</span><span class="p">[</span><span class="n">player</span><span class="p">][</span><span class="s1">&#39;label&#39;</span><span class="p">]</span>
        <span class="n">player_type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">player_meta</span><span class="p">[</span><span class="n">player</span><span class="p">][</span><span class="s1">&#39;type&#39;</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">player_type</span> <span class="o">==</span> <span class="s1">&#39;human&#39;</span><span class="p">:</span>
          <span class="n">move</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{}</span><span class="s2">, what&#39;s your move?&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">player_label</span><span class="p">))</span>
          <span class="c1"># we&#39;re going to allow the user to quit the game from the input line</span>
          <span class="k">if</span> <span class="n">move</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;q&#39;</span><span class="p">,</span> <span class="s1">&#39;quit&#39;</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">winner</span> <span class="o">=</span> <span class="s1">&#39;F&#39;</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;quiting the game&#39;</span><span class="p">)</span>
            <span class="k">break</span>

          <span class="n">move</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">move</span><span class="p">)</span>
          <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">board</span><span class="p">[</span><span class="n">move</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39; &#39;</span><span class="p">:</span>
            <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
              <span class="n">move</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{}</span><span class="s2">, that position is already taken! &quot;</span>\
                          <span class="s2">&quot;What&#39;s your move?&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">player_label</span><span class="p">))</span>  
              <span class="n">move</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">move</span><span class="p">)</span>            
              <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">board</span><span class="p">[</span><span class="n">move</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39; &#39;</span><span class="p">:</span>
                <span class="k">continue</span>
              <span class="k">else</span><span class="p">:</span>
                <span class="k">break</span>

        <span class="k">else</span><span class="p">:</span>
          <span class="c1">##########</span>
          <span class="c1"># Our level 1 ai agent (random)</span>
          <span class="c1">##########</span>
          <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ai_level</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">move</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">random_ai</span><span class="p">()</span>

          <span class="c1">##########</span>
          <span class="c1"># Our level 2 ai agent (heuristic)</span>
          <span class="c1">##########</span>
          <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">ai_level</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">move</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">heuristic_ai</span><span class="p">(</span><span class="n">player_label</span><span class="p">)</span>

          <span class="c1">##########</span>
          <span class="c1"># Our user-defined AI agent</span>
          <span class="c1">##########</span>
          <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">ai_level</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
            <span class="n">move</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">user_ai</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">board</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">win_patterns</span><span class="p">,</span> <span class="n">player_label</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">board</span><span class="p">[</span><span class="n">move</span><span class="p">]</span> <span class="o">=</span> <span class="n">player_label</span>

        <span class="c1"># the winner varaible will now be check within the board object</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">check_winning</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">check_stalemate</span><span class="p">()</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">winner</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
          <span class="k">continue</span>

        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">winner</span> <span class="o">==</span> <span class="s1">&#39;Stalemate&#39;</span><span class="p">:</span>
          <span class="nb">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">check_stalemate</span><span class="p">())</span>
          <span class="bp">self</span><span class="o">.</span><span class="n">visualize_board</span><span class="p">()</span>
          <span class="k">break</span>

        <span class="k">else</span><span class="p">:</span>
          <span class="nb">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">check_winning</span><span class="p">())</span>
          <span class="bp">self</span><span class="o">.</span><span class="n">visualize_board</span><span class="p">()</span>
          <span class="k">break</span>
      <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">winner</span> <span class="o">!=</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span>
</code></pre></div>

<h3 id="102-run-tests">1.0.2 Run Tests<a class="headerlink" href="#102-run-tests" title="Permanent link">&para;</a></h3>
<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">test_n_step_ai</span><span class="p">():</span>
  <span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">42</span><span class="p">)</span>
  <span class="n">game</span> <span class="o">=</span> <span class="n">GameEngine</span><span class="p">(</span><span class="n">setup</span><span class="o">=</span><span class="s1">&#39;auto&#39;</span><span class="p">,</span> <span class="n">user_ai</span><span class="o">=</span><span class="n">n_step_ai</span><span class="p">)</span>
  <span class="n">game</span><span class="o">.</span><span class="n">setup_game</span><span class="p">()</span>
  <span class="n">game</span><span class="o">.</span><span class="n">play_game</span><span class="p">()</span>
  <span class="c1"># check that the winner is X</span>
  <span class="k">assert</span> <span class="n">game</span><span class="o">.</span><span class="n">winner</span> <span class="o">==</span> <span class="s1">&#39;X&#39;</span><span class="p">,</span> <span class="s2">&quot;Winner should be X!&quot;</span>

  <span class="c1"># check that the ai level is set to 3 which means our engine is properly</span>
  <span class="c1"># accessing the user defined ai</span>
  <span class="k">assert</span> <span class="n">game</span><span class="o">.</span><span class="n">ai_level</span> <span class="o">==</span> <span class="mi">3</span><span class="p">,</span> <span class="s2">&quot;The engine is not using the user defined AI!&quot;</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code><span class="n">test_n_step_ai</span><span class="p">()</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code>| | | |
| | | |
| | | |

|X| | |
| | | |
| | | |

|X| | |
| | |O|
| | | |

|X| |X|
| | |O|
| | | |

|X|O|X|
| | |O|
| | | |

|X|O|X|
| |X|O|
| | | |

|X|O|X|
|O|X|O|
| | | |

&#39;X&#39; Won!
|X|O|X|
|O|X|O|
| | |X|
</code></pre></div>

<h2 id="11-reinforcement-learning-reset-step-and-reward">1.1 Reinforcement Learning: Reset, Step, and Reward<a class="headerlink" href="#11-reinforcement-learning-reset-step-and-reward" title="Permanent link">&para;</a></h2>
<p>Firstly, to interact with OpenAI Gym, we need to include a method of reseting the current game.</p>
<h3 id="112-reset">1.1.2 Reset<a class="headerlink" href="#112-reset" title="Permanent link">&para;</a></h3>
<div class="codehilite"><pre><span></span><code><span class="k">class</span> <span class="nc">GameEngine</span><span class="p">(</span><span class="n">TicTacToe</span><span class="p">):</span>
  <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">setup</span><span class="o">=</span><span class="s1">&#39;auto&#39;</span><span class="p">,</span> <span class="n">user_ai</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">setup</span> <span class="o">=</span> <span class="n">setup</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">user_ai</span> <span class="o">=</span> <span class="n">user_ai</span>

  <span class="k">def</span> <span class="nf">heuristic_ai</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">player_label</span><span class="p">):</span>
    <span class="n">opponent</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">,</span> <span class="s1">&#39;O&#39;</span><span class="p">]</span>
    <span class="n">opponent</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">player_label</span><span class="p">)</span>
    <span class="n">opponent</span> <span class="o">=</span> <span class="n">opponent</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

    <span class="n">avail_moves</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">board</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">board</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39; &#39;</span><span class="p">]</span>
    <span class="n">temp_board</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">board</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">middle</span> <span class="o">=</span> <span class="mi">5</span>
    <span class="n">corner</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="mi">9</span><span class="p">]</span>
    <span class="n">side</span> <span class="o">=</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">8</span><span class="p">]</span>

    <span class="c1"># first check for a winning move</span>
    <span class="n">move_found</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">for</span> <span class="n">move</span> <span class="ow">in</span> <span class="n">avail_moves</span><span class="p">:</span>
      <span class="n">temp_board</span><span class="p">[</span><span class="n">move</span><span class="p">]</span> <span class="o">=</span> <span class="n">player_label</span>
      <span class="k">for</span> <span class="n">pattern</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">win_patterns</span><span class="p">:</span>
          <span class="n">values</span> <span class="o">=</span> <span class="p">[</span><span class="n">temp_board</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">pattern</span><span class="p">]</span> 
          <span class="k">if</span> <span class="n">values</span> <span class="o">==</span> <span class="p">[</span><span class="n">player_label</span><span class="p">,</span> <span class="n">player_label</span><span class="p">,</span> <span class="n">player_label</span><span class="p">]:</span>
            <span class="n">move_found</span> <span class="o">=</span> <span class="kc">True</span>       
            <span class="k">break</span>
      <span class="k">if</span> <span class="n">move_found</span><span class="p">:</span>   
        <span class="k">break</span>
      <span class="k">else</span><span class="p">:</span>
        <span class="n">temp_board</span><span class="p">[</span><span class="n">move</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39; &#39;</span>

    <span class="c1"># check if the opponent has a winning move</span>
    <span class="k">if</span> <span class="n">move_found</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
      <span class="k">for</span> <span class="n">move</span> <span class="ow">in</span> <span class="n">avail_moves</span><span class="p">:</span>
        <span class="n">temp_board</span><span class="p">[</span><span class="n">move</span><span class="p">]</span> <span class="o">=</span> <span class="n">opponent</span>
        <span class="k">for</span> <span class="n">pattern</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">win_patterns</span><span class="p">:</span>
            <span class="n">values</span> <span class="o">=</span> <span class="p">[</span><span class="n">temp_board</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">pattern</span><span class="p">]</span> 
            <span class="k">if</span> <span class="n">values</span> <span class="o">==</span> <span class="p">[</span><span class="n">opponent</span><span class="p">,</span> <span class="n">opponent</span><span class="p">,</span> <span class="n">opponent</span><span class="p">]:</span>
              <span class="n">move_found</span> <span class="o">=</span> <span class="kc">True</span>       
              <span class="k">break</span>
        <span class="k">if</span> <span class="n">move_found</span><span class="p">:</span>   
          <span class="k">break</span>
        <span class="k">else</span><span class="p">:</span>
          <span class="n">temp_board</span><span class="p">[</span><span class="n">move</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39; &#39;</span>

    <span class="c1"># check if middle avail</span>
    <span class="k">if</span> <span class="n">move_found</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
      <span class="k">if</span> <span class="n">middle</span> <span class="ow">in</span> <span class="n">avail_moves</span><span class="p">:</span>
        <span class="n">move_found</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">move</span> <span class="o">=</span> <span class="n">middle</span>

    <span class="c1"># check corners</span>
    <span class="k">if</span> <span class="n">move_found</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
      <span class="n">move_corner</span> <span class="o">=</span> <span class="p">[</span><span class="n">val</span> <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">avail_moves</span> <span class="k">if</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">corner</span><span class="p">]</span>
      <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">move_corner</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">move</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">move_corner</span><span class="p">)</span>
        <span class="n">move_found</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="c1"># check side</span>
    <span class="k">if</span> <span class="n">move_found</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
      <span class="n">move_side</span> <span class="o">=</span> <span class="p">[</span><span class="n">val</span> <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">avail_moves</span> <span class="k">if</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">side</span><span class="p">]</span>
      <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">move_side</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">move</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">move_side</span><span class="p">)</span>
        <span class="n">move_found</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="k">return</span> <span class="n">move</span>

  <span class="k">def</span> <span class="nf">random_ai</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
      <span class="n">move</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">9</span><span class="p">)</span>
      <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">board</span><span class="p">[</span><span class="n">move</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39; &#39;</span><span class="p">:</span>
        <span class="k">continue</span>
      <span class="k">else</span><span class="p">:</span>
        <span class="k">break</span>
    <span class="k">return</span> <span class="n">move</span>

  <span class="k">def</span> <span class="nf">setup_game</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">setup</span> <span class="o">==</span> <span class="s1">&#39;user&#39;</span><span class="p">:</span>
      <span class="n">players</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">input</span><span class="p">(</span><span class="s2">&quot;How many Players? (type 0, 1, or 2)&quot;</span><span class="p">))</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">player_meta</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;first&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;label&#39;</span><span class="p">:</span> <span class="s1">&#39;X&#39;</span><span class="p">,</span>
                                    <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;ai&#39;</span><span class="p">},</span> 
                    <span class="s1">&#39;second&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;label&#39;</span><span class="p">:</span> <span class="s1">&#39;O&#39;</span><span class="p">,</span>
                                    <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;human&#39;</span><span class="p">}}</span>
      <span class="k">if</span> <span class="n">players</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">:</span>
        <span class="c1">########## </span>
        <span class="c1"># Allow the user to set the ai level</span>
        <span class="c1">########## </span>

        <span class="c1">### if they have not provided an ai_agent</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">user_ai</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
          <span class="n">level</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">input</span><span class="p">(</span><span class="s2">&quot;select AI level (1, 2)&quot;</span><span class="p">))</span>
          <span class="k">if</span> <span class="n">level</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ai_level</span> <span class="o">=</span> <span class="mi">1</span>
          <span class="k">elif</span> <span class="n">level</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ai_level</span> <span class="o">=</span> <span class="mi">2</span>
          <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Unknown AI level entered, this will cause problems&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
          <span class="bp">self</span><span class="o">.</span><span class="n">ai_level</span> <span class="o">=</span> <span class="mi">3</span>

      <span class="k">if</span> <span class="n">players</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">first</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s2">&quot;who will go first? (X, (AI), or O (Player))&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">first</span> <span class="o">==</span> <span class="s1">&#39;O&#39;</span><span class="p">:</span>
          <span class="bp">self</span><span class="o">.</span><span class="n">player_meta</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;second&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;label&#39;</span><span class="p">:</span> <span class="s1">&#39;X&#39;</span><span class="p">,</span>
                                    <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;ai&#39;</span><span class="p">},</span> 
                        <span class="s1">&#39;first&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;label&#39;</span><span class="p">:</span> <span class="s1">&#39;O&#39;</span><span class="p">,</span>
                                    <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;human&#39;</span><span class="p">}}</span>


      <span class="k">elif</span> <span class="n">players</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">first</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">([</span><span class="s1">&#39;X&#39;</span><span class="p">,</span> <span class="s1">&#39;O&#39;</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">first</span> <span class="o">==</span> <span class="s1">&#39;O&#39;</span><span class="p">:</span>
          <span class="bp">self</span><span class="o">.</span><span class="n">player_meta</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;second&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;label&#39;</span><span class="p">:</span> <span class="s1">&#39;X&#39;</span><span class="p">,</span>
                                    <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;ai&#39;</span><span class="p">},</span> 
                        <span class="s1">&#39;first&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;label&#39;</span><span class="p">:</span> <span class="s1">&#39;O&#39;</span><span class="p">,</span>
                                    <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;ai&#39;</span><span class="p">}}</span>                                
        <span class="k">else</span><span class="p">:</span>
          <span class="bp">self</span><span class="o">.</span><span class="n">player_meta</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;first&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;label&#39;</span><span class="p">:</span> <span class="s1">&#39;X&#39;</span><span class="p">,</span>
                                    <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;ai&#39;</span><span class="p">},</span> 
                        <span class="s1">&#39;second&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;label&#39;</span><span class="p">:</span> <span class="s1">&#39;O&#39;</span><span class="p">,</span>
                                    <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;ai&#39;</span><span class="p">}}</span>


    <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">setup</span> <span class="o">==</span> <span class="s1">&#39;auto&#39;</span><span class="p">:</span>
      <span class="n">first</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">([</span><span class="s1">&#39;X&#39;</span><span class="p">,</span> <span class="s1">&#39;O&#39;</span><span class="p">])</span>
      <span class="k">if</span> <span class="n">first</span> <span class="o">==</span> <span class="s1">&#39;O&#39;</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">start_player</span> <span class="o">=</span> <span class="s1">&#39;O&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">player_meta</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;second&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;label&#39;</span><span class="p">:</span> <span class="s1">&#39;X&#39;</span><span class="p">,</span>
                                  <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;ai&#39;</span><span class="p">},</span> 
                      <span class="s1">&#39;first&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;label&#39;</span><span class="p">:</span> <span class="s1">&#39;O&#39;</span><span class="p">,</span>
                                  <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;ai&#39;</span><span class="p">}}</span>                                
      <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">start_player</span> <span class="o">=</span> <span class="s1">&#39;X&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">player_meta</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;first&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;label&#39;</span><span class="p">:</span> <span class="s1">&#39;X&#39;</span><span class="p">,</span>
                                  <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;ai&#39;</span><span class="p">},</span> 
                      <span class="s1">&#39;second&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;label&#39;</span><span class="p">:</span> <span class="s1">&#39;O&#39;</span><span class="p">,</span>
                                  <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;ai&#39;</span><span class="p">}}</span>
      <span class="c1">########## </span>
      <span class="c1"># and automatically set the ai level otherwise</span>
      <span class="c1">##########  </span>
      <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">user_ai</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>                           
        <span class="bp">self</span><span class="o">.</span><span class="n">ai_level</span> <span class="o">=</span> <span class="mi">2</span>
      <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ai_level</span> <span class="o">=</span> <span class="mi">3</span>

  <span class="k">def</span> <span class="nf">play_game</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
      <span class="k">for</span> <span class="n">player</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;first&#39;</span><span class="p">,</span> <span class="s1">&#39;second&#39;</span><span class="p">]:</span>  
        <span class="bp">self</span><span class="o">.</span><span class="n">visualize_board</span><span class="p">()</span>
        <span class="n">player_label</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">player_meta</span><span class="p">[</span><span class="n">player</span><span class="p">][</span><span class="s1">&#39;label&#39;</span><span class="p">]</span>
        <span class="n">player_type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">player_meta</span><span class="p">[</span><span class="n">player</span><span class="p">][</span><span class="s1">&#39;type&#39;</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">player_type</span> <span class="o">==</span> <span class="s1">&#39;human&#39;</span><span class="p">:</span>
          <span class="n">move</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{}</span><span class="s2">, what&#39;s your move?&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">player_label</span><span class="p">))</span>
          <span class="c1"># we&#39;re going to allow the user to quit the game from the input line</span>
          <span class="k">if</span> <span class="n">move</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;q&#39;</span><span class="p">,</span> <span class="s1">&#39;quit&#39;</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">winner</span> <span class="o">=</span> <span class="s1">&#39;F&#39;</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;quiting the game&#39;</span><span class="p">)</span>
            <span class="k">break</span>

          <span class="n">move</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">move</span><span class="p">)</span>
          <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">board</span><span class="p">[</span><span class="n">move</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39; &#39;</span><span class="p">:</span>
            <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
              <span class="n">move</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{}</span><span class="s2">, that position is already taken! &quot;</span>\
                          <span class="s2">&quot;What&#39;s your move?&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">player_label</span><span class="p">))</span>  
              <span class="n">move</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">move</span><span class="p">)</span>            
              <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">board</span><span class="p">[</span><span class="n">move</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39; &#39;</span><span class="p">:</span>
                <span class="k">continue</span>
              <span class="k">else</span><span class="p">:</span>
                <span class="k">break</span>

        <span class="k">else</span><span class="p">:</span>
          <span class="c1">##########</span>
          <span class="c1"># Our level 1 ai agent (random)</span>
          <span class="c1">##########</span>
          <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ai_level</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">move</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">random_ai</span><span class="p">()</span>

          <span class="c1">##########</span>
          <span class="c1"># Our level 2 ai agent (heuristic)</span>
          <span class="c1">##########</span>
          <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">ai_level</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">move</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">heuristic_ai</span><span class="p">(</span><span class="n">player_label</span><span class="p">)</span>

          <span class="c1">##########</span>
          <span class="c1"># Our user-defined AI agent</span>
          <span class="c1">##########</span>
          <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">ai_level</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
            <span class="n">move</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">user_ai</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">board</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">win_patterns</span><span class="p">,</span> <span class="n">player_label</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">board</span><span class="p">[</span><span class="n">move</span><span class="p">]</span> <span class="o">=</span> <span class="n">player_label</span>

        <span class="c1"># the winner varaible will now be check within the board object</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">check_winning</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">check_stalemate</span><span class="p">()</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">winner</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
          <span class="k">continue</span>

        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">winner</span> <span class="o">==</span> <span class="s1">&#39;Stalemate&#39;</span><span class="p">:</span>
          <span class="nb">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">check_stalemate</span><span class="p">())</span>
          <span class="bp">self</span><span class="o">.</span><span class="n">visualize_board</span><span class="p">()</span>
          <span class="k">break</span>

        <span class="k">else</span><span class="p">:</span>
          <span class="nb">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">check_winning</span><span class="p">())</span>
          <span class="bp">self</span><span class="o">.</span><span class="n">visualize_board</span><span class="p">()</span>
          <span class="k">break</span>
      <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">winner</span> <span class="o">!=</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span>

  <span class="c1">####################################</span>
  <span class="c1"># Adding our ability to reset the game</span>
  <span class="c1">####################################</span>
  <span class="k">def</span> <span class="nf">reset_game</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">board</span> <span class="o">=</span> <span class="p">{</span><span class="mi">1</span><span class="p">:</span> <span class="s1">&#39; &#39;</span><span class="p">,</span>
         <span class="mi">2</span><span class="p">:</span> <span class="s1">&#39; &#39;</span><span class="p">,</span>
         <span class="mi">3</span><span class="p">:</span> <span class="s1">&#39; &#39;</span><span class="p">,</span>
         <span class="mi">4</span><span class="p">:</span> <span class="s1">&#39; &#39;</span><span class="p">,</span>
         <span class="mi">5</span><span class="p">:</span> <span class="s1">&#39; &#39;</span><span class="p">,</span>
         <span class="mi">6</span><span class="p">:</span> <span class="s1">&#39; &#39;</span><span class="p">,</span>
         <span class="mi">7</span><span class="p">:</span> <span class="s1">&#39; &#39;</span><span class="p">,</span>
         <span class="mi">8</span><span class="p">:</span> <span class="s1">&#39; &#39;</span><span class="p">,</span>
         <span class="mi">9</span><span class="p">:</span> <span class="s1">&#39; &#39;</span><span class="p">,}</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">winner</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">setup_game</span><span class="p">()</span>
</code></pre></div>

<p>Let's test our reset:</p>
<div class="codehilite"><pre><span></span><code><span class="n">game</span> <span class="o">=</span> <span class="n">GameEngine</span><span class="p">(</span><span class="s1">&#39;auto&#39;</span><span class="p">)</span>
<span class="n">game</span><span class="o">.</span><span class="n">setup_game</span><span class="p">()</span>
<span class="n">game</span><span class="o">.</span><span class="n">play_game</span><span class="p">()</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code>| | | |
| | | |
| | | |

| | | |
| |X| |
| | | |

| | | |
| |X| |
| | |O|

|X| | |
| |X| |
| | |O|

|X| |O|
| |X| |
| | |O|

|X| |O|
| |X|X|
| | |O|

|X| |O|
|O|X|X|
| | |O|

|X| |O|
|O|X|X|
|X| |O|

|X|O|O|
|O|X|X|
|X| |O|

It&#39;s a stalemate!
|X|O|O|
|O|X|X|
|X|X|O|






&lt;__main__.GameEngine at 0x7f8d4b163bd0&gt;
</code></pre></div>

<div class="codehilite"><pre><span></span><code><span class="n">game</span><span class="o">.</span><span class="n">reset_game</span><span class="p">()</span>
<span class="n">game</span><span class="o">.</span><span class="n">play_game</span><span class="p">()</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code>| | | |
| | | |
| | | |

| | | |
| |X| |
| | | |

| | |O|
| |X| |
| | | |

| | |O|
| |X| |
| | |X|

|O| |O|
| |X| |
| | |X|

|O|X|O|
| |X| |
| | |X|

|O|X|O|
| |X| |
| |O|X|

|O|X|O|
| |X| |
|X|O|X|

|O|X|O|
|O|X| |
|X|O|X|

It&#39;s a stalemate!
|O|X|O|
|O|X|X|
|X|O|X|






&lt;__main__.GameEngine at 0x7f8d4b163bd0&gt;
</code></pre></div>

<p>This <code>reset_game</code> function works the way we intend. However, the big step we will have to make from our current tic tac toe module to one usable by OpenAI is to work with integers rather than strings in our board representation.</p>
<h3 id="113-observation-and-action-spaces">1.1.3 Observation and Action Spaces<a class="headerlink" href="#113-observation-and-action-spaces" title="Permanent link">&para;</a></h3>
<p>The following are the important changes we will have to make to our game class in order to work with OpenAI's built-in reinforcement learning algorithms:</p>
<div class="codehilite"><pre><span></span><code># the board now has integers as values instead of strings
self.board = {1: 0,
      2: 0,
      3: 0,
      4: 0,
      5: 0,
      6: 0,
      7: 0,
      8: 0,
      9: 0,}

# the available token spaces, note that in order to access our board
# dictionary these actions will need to be re-indexed to 1
self.action_space = spaces.Discrete(9)

# the observation space requires int rep for player tokens
self.observation_space = spaces.Box(low=0, high=2, shape=(9,), dtype=np.int)
self.reward_range = (-10, 1)

# we will redefine our player labels as ints
self.player_label = 1
self.opponent_label = 2
</code></pre></div>

<p>Let's take a look at our redefined action space:</p>
<div class="codehilite"><pre><span></span><code><span class="n">board</span> <span class="o">=</span> <span class="p">{</span><span class="mi">1</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
      <span class="mi">2</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
      <span class="mi">3</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
      <span class="mi">4</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
      <span class="mi">5</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
      <span class="mi">6</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
      <span class="mi">7</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
      <span class="mi">8</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
      <span class="mi">9</span><span class="p">:</span> <span class="mi">0</span><span class="p">,}</span>
<span class="n">state</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">board</span><span class="o">.</span><span class="n">values</span><span class="p">()))</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">9</span><span class="p">,)</span>
<span class="n">state</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code>array([0, 0, 0, 0, 0, 0, 0, 0, 0])
</code></pre></div>

<p>Does this align with a random sample of the observation space? It should if it is going to work!</p>
<div class="codehilite"><pre><span></span><code><span class="n">box</span> <span class="o">=</span> <span class="n">spaces</span><span class="o">.</span><span class="n">Box</span><span class="p">(</span><span class="n">low</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">high</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="mi">9</span><span class="p">,),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
<span class="n">box</span><span class="o">.</span><span class="n">sample</span><span class="p">()</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code>array([2, 2, 1, 2, 2, 1, 0, 1, 2])
</code></pre></div>

<p>Let's break this down. For 1 of 9 spaces (defined by shape in <code>spaces.Box</code>), the game board can take on the value of 0, 1, or 2 (defined by low and high in <code>spaces.Box</code>). When we sample from box we get a random snapshot of how the bored could possibly look. The way we've defined <code>state</code> is such that it too, represents how the board could possibly look. <code>state</code> will be returned by both <code>reset</code> and <code>step</code> when we go to wrap all of this in our game environment.</p>
<h3 id="114-step-reward">1.1.4 Step-Reward<a class="headerlink" href="#114-step-reward" title="Permanent link">&para;</a></h3>
<p>Our Reinforcement Learning (RL) agent will have much less information available to them than our prior algorithms. For this we need to define our reward system a little differently. Given a current board the agent receives:</p>
<ul>
<li>+10 for playing a winning move</li>
<li>-100 for playing an invalid move </li>
<li>-10 if the opponent wins the next move</li>
<li>1/9 for playing a valid move</li>
</ul>
<div class="codehilite"><pre><span></span><code><span class="k">class</span> <span class="nc">TicTacToeGym</span><span class="p">(</span><span class="n">GameEngine</span><span class="p">,</span> <span class="n">gym</span><span class="o">.</span><span class="n">Env</span><span class="p">):</span>
  <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">user_ai</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ai_level</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">setup</span> <span class="o">=</span> <span class="s1">&#39;auto&#39;</span>
    <span class="c1"># the default behavior will be no user_ai and ai_level set to 1 (random)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">user_ai</span> <span class="o">=</span> <span class="n">user_ai</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">ai_level</span> <span class="o">=</span> <span class="n">ai_level</span>

    <span class="c1"># the board now has integers as values instead of strings</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">board</span> <span class="o">=</span> <span class="p">{</span><span class="mi">1</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
         <span class="mi">2</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
         <span class="mi">3</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
         <span class="mi">4</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
         <span class="mi">5</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
         <span class="mi">6</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
         <span class="mi">7</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
         <span class="mi">8</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
         <span class="mi">9</span><span class="p">:</span> <span class="mi">0</span><span class="p">,}</span>

    <span class="c1"># the available token spaces, note that in order to access our board</span>
    <span class="c1"># dictionary these actions will need to be re-indexed to 1</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">action_space</span> <span class="o">=</span> <span class="n">spaces</span><span class="o">.</span><span class="n">Discrete</span><span class="p">(</span><span class="mi">9</span><span class="p">)</span>

    <span class="c1"># the observation space requires int rep for player tokens</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">observation_space</span> <span class="o">=</span> <span class="n">spaces</span><span class="o">.</span><span class="n">Box</span><span class="p">(</span><span class="n">low</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">high</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="mi">9</span><span class="p">,),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">reward_range</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="mi">10</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

    <span class="c1"># we will redefine our player labels as ints</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">player_label</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">opponent_label</span> <span class="o">=</span> <span class="mi">2</span>

    <span class="c1"># for StableBaselines</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">spec</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span> <span class="o">=</span> <span class="kc">None</span>

  <span class="c1">##############################################################################</span>
  <span class="c1"># we will have to redefine any function in our previous module that makes use</span>
  <span class="c1"># of the string entries, X and O on the board. We need to replace the logic</span>
  <span class="c1"># with 1&#39;s and 2&#39;s</span>
  <span class="c1">##############################################################################</span>
  <span class="k">def</span> <span class="nf">check_winning</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">pattern</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">win_patterns</span><span class="p">:</span>
      <span class="n">values</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">board</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">pattern</span><span class="p">]</span> 
      <span class="k">if</span> <span class="n">values</span> <span class="o">==</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">winner</span> <span class="o">=</span> <span class="s1">&#39;X&#39;</span> <span class="c1"># we update the winner status</span>
        <span class="k">return</span> <span class="s2">&quot;&#39;X&#39; Won!&quot;</span>
      <span class="k">elif</span> <span class="n">values</span> <span class="o">==</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">]:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">winner</span> <span class="o">=</span> <span class="s1">&#39;O&#39;</span>
        <span class="k">return</span> <span class="s2">&quot;&#39;O&#39; Won!&quot;</span>
    <span class="k">return</span> <span class="s1">&#39;&#39;</span>

  <span class="k">def</span> <span class="nf">check_stalemate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">if</span> <span class="p">(</span><span class="mi">0</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">board</span><span class="o">.</span><span class="n">values</span><span class="p">())</span> <span class="ow">and</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">check_winning</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">):</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">winner</span> <span class="o">=</span> <span class="s1">&#39;Stalemate&#39;</span>
      <span class="k">return</span> <span class="s2">&quot;It&#39;s a stalemate!&quot;</span>

  <span class="k">def</span> <span class="nf">reset_game</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="n">overwrite_ai</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ai_level</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">board</span> <span class="o">=</span> <span class="p">{</span><span class="mi">1</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
         <span class="mi">2</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
         <span class="mi">3</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
         <span class="mi">4</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
         <span class="mi">5</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
         <span class="mi">6</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
         <span class="mi">7</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
         <span class="mi">8</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
         <span class="mi">9</span><span class="p">:</span> <span class="mi">0</span><span class="p">,}</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">winner</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">setup_game</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">ai_level</span> <span class="o">=</span> <span class="n">overwrite_ai</span>
    <span class="c1"># depending now on if X or O is first will need to take the AI&#39;s first step</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">start_player</span> <span class="o">==</span> <span class="s1">&#39;O&#39;</span><span class="p">:</span>
      <span class="n">move</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">random_ai</span><span class="p">()</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">board</span><span class="p">[</span><span class="n">move</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span>

  <span class="k">def</span> <span class="nf">reset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">reset_game</span><span class="p">()</span>
    <span class="n">state</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">board</span><span class="o">.</span><span class="n">values</span><span class="p">()))</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">9</span><span class="p">,)</span>
    <span class="k">return</span> <span class="n">state</span>

  <span class="k">def</span> <span class="nf">random_ai</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
      <span class="n">move</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">9</span><span class="p">)</span>
      <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">board</span><span class="p">[</span><span class="n">move</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">continue</span>
      <span class="k">else</span><span class="p">:</span>
        <span class="k">break</span>
    <span class="k">return</span> <span class="n">move</span>

  <span class="c1">##############################################################################</span>
  <span class="c1"># we will have to recycle a lot of what was previously wrapped up in </span>
  <span class="c1"># play_game() since gym needs access to every point after the Reinf AI</span>
  <span class="c1"># makes a move</span>
  <span class="c1">##############################################################################</span>
  <span class="k">def</span> <span class="nf">step</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">action</span><span class="p">):</span>

      <span class="c1"># gym discrete indexes at 0, our board indexes at 1</span>
      <span class="n">move</span> <span class="o">=</span> <span class="n">action</span> <span class="o">+</span> <span class="mi">1</span>
      <span class="c1"># Check if agent&#39;s move is valid</span>
      <span class="n">avail_moves</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">board</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">board</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">]</span>
      <span class="n">is_valid</span> <span class="o">=</span> <span class="n">move</span> <span class="ow">in</span> <span class="n">avail_moves</span>

      <span class="c1"># if valid, then play the move, and let the other opponent make a move</span>
      <span class="c1"># as well</span>
      <span class="k">if</span> <span class="n">is_valid</span><span class="p">:</span> <span class="c1"># Play the move</span>
          <span class="c1"># update board</span>
          <span class="bp">self</span><span class="o">.</span><span class="n">board</span><span class="p">[</span><span class="n">move</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">player_label</span>
          <span class="bp">self</span><span class="o">.</span><span class="n">check_winning</span><span class="p">()</span>
          <span class="bp">self</span><span class="o">.</span><span class="n">check_stalemate</span><span class="p">()</span>

          <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">winner</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
            <span class="c1">##################################################################</span>
            <span class="c1"># instead of continuing as we did in our play_game loop we will</span>
            <span class="c1"># take one additional step for the AI and then let openAI gym</span>
            <span class="c1"># handle incrementing between steps.</span>
            <span class="c1">##################################################################</span>

            <span class="c1">##########</span>
            <span class="c1"># Our level 1 ai agent (random)</span>
            <span class="c1">##########</span>
            <span class="c1"># if self.ai_level == 1:</span>
            <span class="n">move</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">random_ai</span><span class="p">()</span>

            <span class="c1"># ##########</span>
            <span class="c1"># # Our level 2 ai agent (heuristic)</span>
            <span class="c1"># ##########</span>
            <span class="c1"># elif self.ai_level == 2:</span>
            <span class="c1">#   move = self.heuristic_ai(&#39;O&#39;)</span>

            <span class="c1"># ##########</span>
            <span class="c1"># # Our user-defined AI agent</span>
            <span class="c1"># ##########</span>
            <span class="c1"># elif self.ai_level == 3:</span>
            <span class="c1">#   move = self.user_ai(self.board, self.win_patterns, &#39;O&#39;)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">board</span><span class="p">[</span><span class="n">move</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">opponent_label</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">check_winning</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">check_stalemate</span><span class="p">()</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">winner</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
              <span class="n">reward</span><span class="p">,</span> <span class="n">done</span><span class="p">,</span> <span class="n">info</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="mi">9</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="p">{}</span>

          <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">winner</span> <span class="o">==</span> <span class="s1">&#39;Stalemate&#39;</span><span class="p">:</span>
            <span class="n">reward</span><span class="p">,</span> <span class="n">done</span><span class="p">,</span> <span class="n">info</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="p">{}</span>

          <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">winner</span> <span class="o">==</span> <span class="s1">&#39;X&#39;</span><span class="p">:</span>
            <span class="n">reward</span><span class="p">,</span> <span class="n">done</span><span class="p">,</span> <span class="n">info</span> <span class="o">=</span> <span class="mi">100</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="p">{}</span>

          <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">winner</span> <span class="o">==</span> <span class="s1">&#39;O&#39;</span><span class="p">:</span>
            <span class="n">reward</span><span class="p">,</span> <span class="n">done</span><span class="p">,</span> <span class="n">info</span> <span class="o">=</span> <span class="o">-</span><span class="mi">10</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="p">{}</span>

      <span class="k">else</span><span class="p">:</span> <span class="c1"># End the game and penalize agent</span>
          <span class="n">reward</span><span class="p">,</span> <span class="n">done</span><span class="p">,</span> <span class="n">info</span> <span class="o">=</span> <span class="o">-</span><span class="mi">100</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="p">{}</span>

      <span class="n">state</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">board</span><span class="o">.</span><span class="n">values</span><span class="p">()))</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">9</span><span class="p">,)</span>
      <span class="k">return</span> <span class="n">state</span><span class="p">,</span> <span class="n">reward</span><span class="p">,</span> <span class="n">done</span><span class="p">,</span> <span class="n">info</span>
</code></pre></div>

<h3 id="115-testing-the-environment">1.1.5 Testing the Environment<a class="headerlink" href="#115-testing-the-environment" title="Permanent link">&para;</a></h3>
<p>We can check that the environment is compatible with gym using <code>check_env</code>. Notice the below doesn't return any error messages. This means everything is working ok!</p>
<div class="codehilite"><pre><span></span><code><span class="n">env</span> <span class="o">=</span> <span class="n">TicTacToeGym</span><span class="p">()</span>
<span class="n">check_env</span><span class="p">(</span><span class="n">env</span><span class="p">)</span>
</code></pre></div>

<p>We can also define a model from OpenAI and see how our game board updates in a single step with the new wrapper</p>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span> <span class="nn">stable_baselines.common.policies</span> <span class="kn">import</span> <span class="n">MlpPolicy</span>
<span class="kn">from</span> <span class="nn">stable_baselines.common.vec_env</span> <span class="kn">import</span> <span class="n">DummyVecEnv</span>
<span class="kn">from</span> <span class="nn">stable_baselines</span> <span class="kn">import</span> <span class="n">PPO2</span>

<span class="n">env</span> <span class="o">=</span> <span class="n">TicTacToeGym</span><span class="p">()</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">PPO2</span><span class="p">(</span><span class="n">MlpPolicy</span><span class="p">,</span> <span class="n">env</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code>Wrapping the env in a DummyVecEnv.
WARNING:tensorflow:From /usr/local/lib/python3.7/dist-packages/stable_baselines/common/tf_util.py:58: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.

WARNING:tensorflow:From /usr/local/lib/python3.7/dist-packages/stable_baselines/common/tf_util.py:67: The name tf.Session is deprecated. Please use tf.compat.v1.Session instead.

WARNING:tensorflow:From /usr/local/lib/python3.7/dist-packages/stable_baselines/common/policies.py:115: The name tf.variable_scope is deprecated. Please use tf.compat.v1.variable_scope instead.

WARNING:tensorflow:From /usr/local/lib/python3.7/dist-packages/stable_baselines/common/input.py:25: The name tf.placeholder is deprecated. Please use tf.compat.v1.placeholder instead.

WARNING:tensorflow:From /usr/local/lib/python3.7/dist-packages/stable_baselines/common/policies.py:560: flatten (from tensorflow.python.layers.core) is deprecated and will be removed in a future version.
Instructions for updating:
Use keras.layers.flatten instead.
WARNING:tensorflow:From /usr/local/lib/python3.7/dist-packages/tensorflow_core/python/layers/core.py:332: Layer.apply (from tensorflow.python.keras.engine.base_layer) is deprecated and will be removed in a future version.
Instructions for updating:
Please use `layer.__call__` method instead.
WARNING:tensorflow:From /usr/local/lib/python3.7/dist-packages/stable_baselines/a2c/utils.py:156: The name tf.get_variable is deprecated. Please use tf.compat.v1.get_variable instead.

WARNING:tensorflow:From /usr/local/lib/python3.7/dist-packages/stable_baselines/common/distributions.py:326: The name tf.random_uniform is deprecated. Please use tf.random.uniform instead.

WARNING:tensorflow:From /usr/local/lib/python3.7/dist-packages/stable_baselines/common/distributions.py:327: The name tf.log is deprecated. Please use tf.math.log instead.

WARNING:tensorflow:From /usr/local/lib/python3.7/dist-packages/stable_baselines/ppo2/ppo2.py:194: The name tf.summary.scalar is deprecated. Please use tf.compat.v1.summary.scalar instead.

WARNING:tensorflow:From /usr/local/lib/python3.7/dist-packages/stable_baselines/ppo2/ppo2.py:202: The name tf.trainable_variables is deprecated. Please use tf.compat.v1.trainable_variables instead.

WARNING:tensorflow:From /usr/local/lib/python3.7/dist-packages/tensorflow_core/python/ops/math_grad.py:1424: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
WARNING:tensorflow:From /usr/local/lib/python3.7/dist-packages/stable_baselines/ppo2/ppo2.py:210: The name tf.train.AdamOptimizer is deprecated. Please use tf.compat.v1.train.AdamOptimizer instead.

WARNING:tensorflow:From /usr/local/lib/python3.7/dist-packages/stable_baselines/ppo2/ppo2.py:244: The name tf.global_variables_initializer is deprecated. Please use tf.compat.v1.global_variables_initializer instead.

WARNING:tensorflow:From /usr/local/lib/python3.7/dist-packages/stable_baselines/ppo2/ppo2.py:246: The name tf.summary.merge_all is deprecated. Please use tf.compat.v1.summary.merge_all instead.
</code></pre></div>

<div class="codehilite"><pre><span></span><code><span class="c1"># test our reset function</span>
<span class="n">obs</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>

<span class="c1"># the start player should randomly select between X and O</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;the start player: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">env</span><span class="o">.</span><span class="n">start_player</span><span class="p">))</span>

<span class="c1"># we should return an action from model.predict</span>
<span class="n">action</span><span class="p">,</span> <span class="n">_states</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">obs</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;the taken action: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">action</span><span class="p">))</span>


<span class="c1"># we divert default behavior of setup_game by saving and reestablishing our</span>
<span class="c1"># user input ai_level</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;AI level: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">env</span><span class="o">.</span><span class="n">ai_level</span><span class="p">))</span>

<span class="c1"># check the board update from env.step()</span>
<span class="n">obs</span><span class="p">,</span> <span class="n">rewards</span><span class="p">,</span> <span class="n">dones</span><span class="p">,</span> <span class="n">info</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">step</span><span class="p">(</span><span class="n">action</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">obs</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Should be blank if no winner: [</span><span class="si">{}</span><span class="s2">]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">env</span><span class="o">.</span><span class="n">check_winning</span><span class="p">()))</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code>the start player: O
the taken action: 7
AI level: 1
[0 0 0 0 2 2 0 1 0]
Should be blank if no winner: []
</code></pre></div>

<p>And we can still visualize the board:</p>
<div class="codehilite"><pre><span></span><code><span class="n">env</span><span class="o">.</span><span class="n">visualize_board</span><span class="p">()</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code>|0|0|0|
|0|2|2|
|0|1|0|
</code></pre></div>

<p>And check that our untrained model will win approx half the time:</p>
<div class="codehilite"><pre><span></span><code><span class="n">winners</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1000</span><span class="p">):</span>
  <span class="n">obs</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>
  <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">):</span>
      <span class="n">action</span><span class="p">,</span> <span class="n">_states</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">obs</span><span class="p">)</span>
      <span class="c1"># print(action)</span>
      <span class="n">obs</span><span class="p">,</span> <span class="n">rewards</span><span class="p">,</span> <span class="n">dones</span><span class="p">,</span> <span class="n">info</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">step</span><span class="p">(</span><span class="n">action</span><span class="p">)</span>
      <span class="c1"># env.visualize_board()</span>
      <span class="k">if</span> <span class="n">env</span><span class="o">.</span><span class="n">winner</span> <span class="o">!=</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
        <span class="n">winners</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">env</span><span class="o">.</span><span class="n">winner</span><span class="p">)</span>
        <span class="k">break</span>

<span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">winners</span><span class="p">)</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code>O            385
X            322
Stalemate     61
dtype: int64
</code></pre></div>

<h3 id="116-training-the-model">1.1.6 Training the Model<a class="headerlink" href="#116-training-the-model" title="Permanent link">&para;</a></h3>
<p>Now we will train the PPO2 model on our environment!</p>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span> <span class="nn">stable_baselines.common.policies</span> <span class="kn">import</span> <span class="n">MlpPolicy</span>
<span class="kn">from</span> <span class="nn">stable_baselines.common.vec_env</span> <span class="kn">import</span> <span class="n">DummyVecEnv</span>
<span class="kn">from</span> <span class="nn">stable_baselines</span> <span class="kn">import</span> <span class="n">PPO2</span>

<span class="n">env</span> <span class="o">=</span> <span class="n">TicTacToeGym</span><span class="p">()</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">PPO2</span><span class="p">(</span><span class="n">MlpPolicy</span><span class="p">,</span> <span class="n">env</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">model</span><span class="o">.</span><span class="n">learn</span><span class="p">(</span><span class="n">total_timesteps</span><span class="o">=</span><span class="mi">100000</span><span class="p">)</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code><span class="n">obs</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">):</span>
    <span class="n">action</span><span class="p">,</span> <span class="n">_states</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">obs</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">action</span><span class="p">)</span>
    <span class="n">obs</span><span class="p">,</span> <span class="n">rewards</span><span class="p">,</span> <span class="n">dones</span><span class="p">,</span> <span class="n">info</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">step</span><span class="p">(</span><span class="n">action</span><span class="p">)</span>
    <span class="n">env</span><span class="o">.</span><span class="n">visualize_board</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">env</span><span class="o">.</span><span class="n">winner</span> <span class="o">!=</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
      <span class="nb">print</span><span class="p">(</span><span class="n">env</span><span class="o">.</span><span class="n">winner</span><span class="p">)</span>
      <span class="k">break</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code>4
|0|0|0|
|0|1|2|
|0|0|0|

8
|2|0|0|
|0|1|2|
|0|0|1|

6
|2|0|2|
|0|1|2|
|1|0|1|

7
|2|0|2|
|0|1|2|
|1|1|1|

X
</code></pre></div>

<div class="codehilite"><pre><span></span><code><span class="n">winners</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1000</span><span class="p">):</span>
  <span class="n">obs</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>
  <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">):</span>
      <span class="n">action</span><span class="p">,</span> <span class="n">_states</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">obs</span><span class="p">)</span>
      <span class="c1"># print(action)</span>
      <span class="n">obs</span><span class="p">,</span> <span class="n">rewards</span><span class="p">,</span> <span class="n">dones</span><span class="p">,</span> <span class="n">info</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">step</span><span class="p">(</span><span class="n">action</span><span class="p">)</span>
      <span class="c1"># env.visualize_board()</span>
      <span class="k">if</span> <span class="n">env</span><span class="o">.</span><span class="n">winner</span> <span class="o">!=</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
        <span class="n">winners</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">env</span><span class="o">.</span><span class="n">winner</span><span class="p">)</span>
        <span class="k">break</span>
</code></pre></div>

<p>Let's see how many times our trained model won:</p>
<div class="codehilite"><pre><span></span><code><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">winners</span><span class="p">)</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code>X            795
O            172
Stalemate     27
dtype: int64
</code></pre></div>

<p>Not terrible! Could be better! Let's play against our model</p>
<h3 id="117-play-against-the-model">1.1.7 Play Against the Model<a class="headerlink" href="#117-play-against-the-model" title="Permanent link">&para;</a></h3>
<p>To make our model compatible with the old <code>play_game</code> method, we will need a way to convert to and from int vs string representations on our board. Let's test this:</p>
<div class="codehilite"><pre><span></span><code><span class="n">value_map</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39; &#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
             <span class="s1">&#39;X&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
             <span class="s1">&#39;O&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">}</span>

<span class="n">board</span> <span class="o">=</span> <span class="p">{</span><span class="mi">1</span><span class="p">:</span> <span class="s1">&#39;X&#39;</span><span class="p">,</span>
         <span class="mi">2</span><span class="p">:</span> <span class="s1">&#39; &#39;</span><span class="p">,</span>
         <span class="mi">3</span><span class="p">:</span> <span class="s1">&#39; &#39;</span><span class="p">,</span>
         <span class="mi">4</span><span class="p">:</span> <span class="s1">&#39; &#39;</span><span class="p">,</span>
         <span class="mi">5</span><span class="p">:</span> <span class="s1">&#39; &#39;</span><span class="p">,</span>
         <span class="mi">6</span><span class="p">:</span> <span class="s1">&#39; &#39;</span><span class="p">,</span>
         <span class="mi">7</span><span class="p">:</span> <span class="s1">&#39; &#39;</span><span class="p">,</span>
         <span class="mi">8</span><span class="p">:</span> <span class="s1">&#39; &#39;</span><span class="p">,</span>
         <span class="mi">9</span><span class="p">:</span> <span class="s1">&#39; &#39;</span><span class="p">,}</span>

<span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">board</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
  <span class="n">board</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value_map</span><span class="p">[</span><span class="n">board</span><span class="p">[</span><span class="n">key</span><span class="p">]]</span>

<span class="n">board</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code>{1: 1, 2: 0, 3: 0, 4: 0, 5: 0, 6: 0, 7: 0, 8: 0, 9: 0}
</code></pre></div>

<p>And now we can wrap it up into a new ai function:</p>
<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">rl_ai</span><span class="p">(</span><span class="n">board</span><span class="p">,</span> <span class="n">win_patterns</span><span class="p">,</span> <span class="n">player_label</span><span class="p">,</span> <span class="n">model</span><span class="o">=</span><span class="n">model</span><span class="p">):</span>
  <span class="c1"># note that we are simply leaving win_patterns and player_label</span>
  <span class="c1"># here so that we can use the game engine as defined in prior</span>
  <span class="c1"># sessions, these inputs are ignored.</span>

  <span class="n">ai_board</span> <span class="o">=</span> <span class="n">board</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
  <span class="n">value_map</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39; &#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
             <span class="s1">&#39;X&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
             <span class="s1">&#39;O&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">}</span>
  <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">ai_board</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
    <span class="n">ai_board</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value_map</span><span class="p">[</span><span class="n">ai_board</span><span class="p">[</span><span class="n">key</span><span class="p">]]</span>

  <span class="n">obs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">ai_board</span><span class="o">.</span><span class="n">values</span><span class="p">()))</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">9</span><span class="p">,)</span>
  <span class="n">action</span><span class="p">,</span> <span class="n">_states</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">obs</span><span class="p">)</span>
  <span class="n">move</span> <span class="o">=</span> <span class="n">action</span> <span class="o">+</span> <span class="mi">1</span>
  <span class="k">return</span> <span class="n">move</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code><span class="n">game</span> <span class="o">=</span> <span class="n">GameEngine</span><span class="p">(</span><span class="s1">&#39;user&#39;</span><span class="p">,</span> <span class="n">user_ai</span><span class="o">=</span><span class="n">rl_ai</span><span class="p">)</span>
<span class="n">game</span><span class="o">.</span><span class="n">setup_game</span><span class="p">()</span>
<span class="n">game</span><span class="o">.</span><span class="n">play_game</span><span class="p">()</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code>How many Players? (type 0, 1, or 2)1
who will go first? (X, (AI), or O (Player))X
| | | |
| | | |
| | | |

| | | |
| |X| |
| | | |

O, what&#39;s your move?1
|O| | |
| |X| |
| | | |

|O| |X|
| |X| |
| | | |

O, what&#39;s your move?7
|O| |X|
| |X| |
|O| | |

|O| |X|
| |X| |
|O| |X|

O, what&#39;s your move?4
&#39;O&#39; Won!
|O| |X|
|O|X| |
|O| |X|






&lt;__main__.GameEngine at 0x7f8d40c4fb10&gt;
</code></pre></div>

<p>Notice any interesting behaviors about the model?</p>
<h2 id="12-improve-the-model">1.2 Improve the Model<a class="headerlink" href="#12-improve-the-model" title="Permanent link">&para;</a></h2>
<p>How can we improve this puppy? What about training the model against a smarter opponent? changing the reward values? training for longer? OR trying a different reinforcement learning model? Try any or all of these and see what works!</p>
<div class="codehilite"><pre><span></span><code><span class="k">class</span> <span class="nc">TicTacToeGym</span><span class="p">(</span><span class="n">GameEngine</span><span class="p">,</span> <span class="n">gym</span><span class="o">.</span><span class="n">Env</span><span class="p">):</span>
  <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">user_ai</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ai_level</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">setup</span> <span class="o">=</span> <span class="s1">&#39;auto&#39;</span>
    <span class="c1"># the default behavior will be no user_ai and ai_level set to 1 (random)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">user_ai</span> <span class="o">=</span> <span class="n">user_ai</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">ai_level</span> <span class="o">=</span> <span class="n">ai_level</span>

    <span class="c1"># the board now has integers as values instead of strings</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">board</span> <span class="o">=</span> <span class="p">{</span><span class="mi">1</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
         <span class="mi">2</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
         <span class="mi">3</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
         <span class="mi">4</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
         <span class="mi">5</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
         <span class="mi">6</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
         <span class="mi">7</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
         <span class="mi">8</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
         <span class="mi">9</span><span class="p">:</span> <span class="mi">0</span><span class="p">,}</span>

    <span class="c1"># the available token spaces, note that in order to access our board</span>
    <span class="c1"># dictionary these actions will need to be re-indexed to 1</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">action_space</span> <span class="o">=</span> <span class="n">spaces</span><span class="o">.</span><span class="n">Discrete</span><span class="p">(</span><span class="mi">9</span><span class="p">)</span>

    <span class="c1"># the observation space requires int rep for player tokens</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">observation_space</span> <span class="o">=</span> <span class="n">spaces</span><span class="o">.</span><span class="n">Box</span><span class="p">(</span><span class="n">low</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">high</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="mi">9</span><span class="p">,),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">reward_range</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="mi">10</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

    <span class="c1"># we will redefine our player labels as ints</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">player_label</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">opponent_label</span> <span class="o">=</span> <span class="mi">2</span>

    <span class="c1"># for StableBaselines</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">spec</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span> <span class="o">=</span> <span class="kc">None</span>

  <span class="c1">##############################################################################</span>
  <span class="c1"># we will have to redefine any function in our previous module that makes use</span>
  <span class="c1"># of the string entries, X and O on the board. We need to replace the logic</span>
  <span class="c1"># with 1&#39;s and 2&#39;s</span>
  <span class="c1">##############################################################################</span>
  <span class="k">def</span> <span class="nf">check_winning</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">pattern</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">win_patterns</span><span class="p">:</span>
      <span class="n">values</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">board</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">pattern</span><span class="p">]</span> 
      <span class="k">if</span> <span class="n">values</span> <span class="o">==</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">winner</span> <span class="o">=</span> <span class="s1">&#39;X&#39;</span> <span class="c1"># we update the winner status</span>
        <span class="k">return</span> <span class="s2">&quot;&#39;X&#39; Won!&quot;</span>
      <span class="k">elif</span> <span class="n">values</span> <span class="o">==</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">]:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">winner</span> <span class="o">=</span> <span class="s1">&#39;O&#39;</span>
        <span class="k">return</span> <span class="s2">&quot;&#39;O&#39; Won!&quot;</span>
    <span class="k">return</span> <span class="s1">&#39;&#39;</span>

  <span class="k">def</span> <span class="nf">check_stalemate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">if</span> <span class="p">(</span><span class="mi">0</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">board</span><span class="o">.</span><span class="n">values</span><span class="p">())</span> <span class="ow">and</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">check_winning</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">):</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">winner</span> <span class="o">=</span> <span class="s1">&#39;Stalemate&#39;</span>
      <span class="k">return</span> <span class="s2">&quot;It&#39;s a stalemate!&quot;</span>

  <span class="k">def</span> <span class="nf">reset_game</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="n">overwrite_ai</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ai_level</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">board</span> <span class="o">=</span> <span class="p">{</span><span class="mi">1</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
         <span class="mi">2</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
         <span class="mi">3</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
         <span class="mi">4</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
         <span class="mi">5</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
         <span class="mi">6</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
         <span class="mi">7</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
         <span class="mi">8</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
         <span class="mi">9</span><span class="p">:</span> <span class="mi">0</span><span class="p">,}</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">winner</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">setup_game</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">ai_level</span> <span class="o">=</span> <span class="n">overwrite_ai</span>
    <span class="c1"># depending now on if X or O is first will need to take the AI&#39;s first step</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">start_player</span> <span class="o">==</span> <span class="s1">&#39;O&#39;</span><span class="p">:</span>
      <span class="n">move</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">random_ai</span><span class="p">()</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">board</span><span class="p">[</span><span class="n">move</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span>

  <span class="k">def</span> <span class="nf">reset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">reset_game</span><span class="p">()</span>
    <span class="n">state</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">board</span><span class="o">.</span><span class="n">values</span><span class="p">()))</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">9</span><span class="p">,)</span>
    <span class="k">return</span> <span class="n">state</span>

  <span class="k">def</span> <span class="nf">random_ai</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
      <span class="n">move</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">9</span><span class="p">)</span>
      <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">board</span><span class="p">[</span><span class="n">move</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">continue</span>
      <span class="k">else</span><span class="p">:</span>
        <span class="k">break</span>
    <span class="k">return</span> <span class="n">move</span>

  <span class="k">def</span> <span class="nf">heuristic_ai</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">player_label</span><span class="p">):</span>
    <span class="n">opponent</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span>
    <span class="n">opponent</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">player_label</span><span class="p">)</span>
    <span class="n">opponent</span> <span class="o">=</span> <span class="n">opponent</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

    <span class="n">avail_moves</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">board</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">board</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">]</span>
    <span class="n">temp_board</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">board</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">middle</span> <span class="o">=</span> <span class="mi">5</span>
    <span class="n">corner</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="mi">9</span><span class="p">]</span>
    <span class="n">side</span> <span class="o">=</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">8</span><span class="p">]</span>

    <span class="c1"># first check for a winning move</span>
    <span class="n">move_found</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">for</span> <span class="n">move</span> <span class="ow">in</span> <span class="n">avail_moves</span><span class="p">:</span>
      <span class="n">temp_board</span><span class="p">[</span><span class="n">move</span><span class="p">]</span> <span class="o">=</span> <span class="n">player_label</span>
      <span class="k">for</span> <span class="n">pattern</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">win_patterns</span><span class="p">:</span>
          <span class="n">values</span> <span class="o">=</span> <span class="p">[</span><span class="n">temp_board</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">pattern</span><span class="p">]</span> 
          <span class="k">if</span> <span class="n">values</span> <span class="o">==</span> <span class="p">[</span><span class="n">player_label</span><span class="p">,</span> <span class="n">player_label</span><span class="p">,</span> <span class="n">player_label</span><span class="p">]:</span>
            <span class="n">move_found</span> <span class="o">=</span> <span class="kc">True</span>       
            <span class="k">break</span>
      <span class="k">if</span> <span class="n">move_found</span><span class="p">:</span>   
        <span class="k">break</span>
      <span class="k">else</span><span class="p">:</span>
        <span class="n">temp_board</span><span class="p">[</span><span class="n">move</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="c1"># check if the opponent has a winning move</span>
    <span class="k">if</span> <span class="n">move_found</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
      <span class="k">for</span> <span class="n">move</span> <span class="ow">in</span> <span class="n">avail_moves</span><span class="p">:</span>
        <span class="n">temp_board</span><span class="p">[</span><span class="n">move</span><span class="p">]</span> <span class="o">=</span> <span class="n">opponent</span>
        <span class="k">for</span> <span class="n">pattern</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">win_patterns</span><span class="p">:</span>
            <span class="n">values</span> <span class="o">=</span> <span class="p">[</span><span class="n">temp_board</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">pattern</span><span class="p">]</span> 
            <span class="k">if</span> <span class="n">values</span> <span class="o">==</span> <span class="p">[</span><span class="n">opponent</span><span class="p">,</span> <span class="n">opponent</span><span class="p">,</span> <span class="n">opponent</span><span class="p">]:</span>
              <span class="n">move_found</span> <span class="o">=</span> <span class="kc">True</span>       
              <span class="k">break</span>
        <span class="k">if</span> <span class="n">move_found</span><span class="p">:</span>   
          <span class="k">break</span>
        <span class="k">else</span><span class="p">:</span>
          <span class="n">temp_board</span><span class="p">[</span><span class="n">move</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="c1"># check if middle avail</span>
    <span class="k">if</span> <span class="n">move_found</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
      <span class="k">if</span> <span class="n">middle</span> <span class="ow">in</span> <span class="n">avail_moves</span><span class="p">:</span>
        <span class="n">move_found</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">move</span> <span class="o">=</span> <span class="n">middle</span>

    <span class="c1"># check corners</span>
    <span class="k">if</span> <span class="n">move_found</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
      <span class="n">move_corner</span> <span class="o">=</span> <span class="p">[</span><span class="n">val</span> <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">avail_moves</span> <span class="k">if</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">corner</span><span class="p">]</span>
      <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">move_corner</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">move</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">move_corner</span><span class="p">)</span>
        <span class="n">move_found</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="c1"># check side</span>
    <span class="k">if</span> <span class="n">move_found</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
      <span class="n">move_side</span> <span class="o">=</span> <span class="p">[</span><span class="n">val</span> <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">avail_moves</span> <span class="k">if</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">side</span><span class="p">]</span>
      <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">move_side</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">move</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">move_side</span><span class="p">)</span>
        <span class="n">move_found</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="k">return</span> <span class="n">move</span>

  <span class="c1">##############################################################################</span>
  <span class="c1"># we will have to recycle a lot of what was previously wrapped up in </span>
  <span class="c1"># play_game() since gym needs access to every point after the Reinf AI</span>
  <span class="c1"># makes a move</span>
  <span class="c1">##############################################################################</span>
  <span class="k">def</span> <span class="nf">step</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">action</span><span class="p">):</span>

      <span class="c1"># gym discrete indexes at 0, our board indexes at 1</span>
      <span class="n">move</span> <span class="o">=</span> <span class="n">action</span> <span class="o">+</span> <span class="mi">1</span>
      <span class="c1"># Check if agent&#39;s move is valid</span>
      <span class="n">avail_moves</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">board</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">board</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">]</span>
      <span class="n">is_valid</span> <span class="o">=</span> <span class="n">move</span> <span class="ow">in</span> <span class="n">avail_moves</span>

      <span class="c1"># if valid, then play the move, and let the other opponent make a move</span>
      <span class="c1"># as well</span>
      <span class="k">if</span> <span class="n">is_valid</span><span class="p">:</span> <span class="c1"># Play the move</span>
          <span class="c1"># update board</span>
          <span class="bp">self</span><span class="o">.</span><span class="n">board</span><span class="p">[</span><span class="n">move</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">player_label</span>
          <span class="bp">self</span><span class="o">.</span><span class="n">check_winning</span><span class="p">()</span>
          <span class="bp">self</span><span class="o">.</span><span class="n">check_stalemate</span><span class="p">()</span>

          <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">winner</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
            <span class="c1">##################################################################</span>
            <span class="c1"># instead of continuing as we did in our play_game loop we will</span>
            <span class="c1"># take one additional step for the AI and then let openAI gym</span>
            <span class="c1"># handle incrementing between steps.</span>
            <span class="c1">##################################################################</span>

            <span class="c1">##########</span>
            <span class="c1"># Our level 1 ai agent (random)</span>
            <span class="c1">##########</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ai_level</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
              <span class="n">move</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">random_ai</span><span class="p">()</span>

            <span class="c1"># ##########</span>
            <span class="c1"># # Our level 2 ai agent (heuristic)</span>
            <span class="c1"># ##########</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">ai_level</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
              <span class="n">move</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">heuristic_ai</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">player_label</span><span class="p">)</span>

            <span class="c1"># ##########</span>
            <span class="c1"># # Our user-defined AI agent</span>
            <span class="c1"># ##########</span>
            <span class="c1"># elif self.ai_level == 3:</span>
            <span class="c1">#   move = self.user_ai(self.board, self.win_patterns, &#39;O&#39;)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">board</span><span class="p">[</span><span class="n">move</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">opponent_label</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">check_winning</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">check_stalemate</span><span class="p">()</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">winner</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
              <span class="n">reward</span><span class="p">,</span> <span class="n">done</span><span class="p">,</span> <span class="n">info</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="mi">9</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="p">{}</span>

          <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">winner</span> <span class="o">==</span> <span class="s1">&#39;Stalemate&#39;</span><span class="p">:</span>
            <span class="n">reward</span><span class="p">,</span> <span class="n">done</span><span class="p">,</span> <span class="n">info</span> <span class="o">=</span> <span class="o">-</span><span class="mi">10</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="p">{}</span>

          <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">winner</span> <span class="o">==</span> <span class="s1">&#39;X&#39;</span><span class="p">:</span>
            <span class="n">reward</span><span class="p">,</span> <span class="n">done</span><span class="p">,</span> <span class="n">info</span> <span class="o">=</span> <span class="mi">50</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="p">{}</span>

          <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">winner</span> <span class="o">==</span> <span class="s1">&#39;O&#39;</span><span class="p">:</span>
            <span class="n">reward</span><span class="p">,</span> <span class="n">done</span><span class="p">,</span> <span class="n">info</span> <span class="o">=</span> <span class="o">-</span><span class="mi">50</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="p">{}</span>

      <span class="k">else</span><span class="p">:</span> <span class="c1"># End the game and penalize agent</span>
          <span class="n">reward</span><span class="p">,</span> <span class="n">done</span><span class="p">,</span> <span class="n">info</span> <span class="o">=</span> <span class="o">-</span><span class="mi">100</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="p">{}</span>

      <span class="n">state</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">board</span><span class="o">.</span><span class="n">values</span><span class="p">()))</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">9</span><span class="p">,)</span>
      <span class="k">return</span> <span class="n">state</span><span class="p">,</span> <span class="n">reward</span><span class="p">,</span> <span class="n">done</span><span class="p">,</span> <span class="n">info</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code><span class="kn">from</span> <span class="nn">stable_baselines.common.policies</span> <span class="kn">import</span> <span class="n">MlpPolicy</span>
<span class="kn">from</span> <span class="nn">stable_baselines.common.vec_env</span> <span class="kn">import</span> <span class="n">DummyVecEnv</span>
<span class="kn">from</span> <span class="nn">stable_baselines</span> <span class="kn">import</span> <span class="n">PPO2</span>

<span class="n">env</span> <span class="o">=</span> <span class="n">TicTacToeGym</span><span class="p">(</span><span class="n">ai_level</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">PPO2</span><span class="p">(</span><span class="n">MlpPolicy</span><span class="p">,</span> <span class="n">env</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">model</span><span class="o">.</span><span class="n">learn</span><span class="p">(</span><span class="n">total_timesteps</span><span class="o">=</span><span class="mi">100000</span><span class="p">)</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code><span class="n">winners</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1000</span><span class="p">):</span>
  <span class="n">obs</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>
  <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">):</span>
      <span class="n">action</span><span class="p">,</span> <span class="n">_states</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">obs</span><span class="p">)</span>
      <span class="c1"># print(action)</span>
      <span class="n">obs</span><span class="p">,</span> <span class="n">rewards</span><span class="p">,</span> <span class="n">dones</span><span class="p">,</span> <span class="n">info</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">step</span><span class="p">(</span><span class="n">action</span><span class="p">)</span>
      <span class="c1"># env.visualize_board()</span>
      <span class="k">if</span> <span class="n">env</span><span class="o">.</span><span class="n">winner</span> <span class="o">!=</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
        <span class="n">winners</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">env</span><span class="o">.</span><span class="n">winner</span><span class="p">)</span>
        <span class="k">break</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">winners</span><span class="p">)</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code>X            791
O            191
Stalemate     10
dtype: int64
</code></pre></div>

<div class="codehilite"><pre><span></span><code><span class="n">game</span> <span class="o">=</span> <span class="n">GameEngine</span><span class="p">(</span><span class="s1">&#39;user&#39;</span><span class="p">,</span> <span class="n">user_ai</span><span class="o">=</span><span class="n">rl_ai</span><span class="p">)</span>
<span class="n">game</span><span class="o">.</span><span class="n">setup_game</span><span class="p">()</span>
<span class="n">game</span><span class="o">.</span><span class="n">play_game</span><span class="p">()</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code>How many Players? (type 0, 1, or 2)1
who will go first? (X, (AI), or O (Player))X
| | | |
| | | |
| | | |

| | | |
| |X| |
| | | |

O, what&#39;s your move?1
|O| | |
| |X| |
| | | |

|O| | |
| |X| |
|X| | |

O, what&#39;s your move?2
|O|O| |
| |X| |
|X| | |

|O|O| |
| |X|X|
|X| | |

O, what&#39;s your move?3
&#39;O&#39; Won!
|O|O|O|
| |X|X|
|X| | |






&lt;__main__.GameEngine at 0x7f6433286510&gt;
</code></pre></div>

              
            </article>
          </div>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
    <nav class="md-footer__inner md-grid" aria-label="Footer">
      
        
        <a href="../../project/P1_Monolithic/" class="md-footer__link md-footer__link--prev" aria-label="Previous: Monolithic Tic-Tac-Toe App" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              Monolithic Tic-Tac-Toe App
            </div>
          </div>
        </a>
      
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "../..", "features": [], "translations": {"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing", "select.version.title": "Select version"}, "search": "../../assets/javascripts/workers/search.361d90f1.min.js"}</script>
    
    
      <script src="../../assets/javascripts/bundle.289a2a4b.min.js"></script>
      
        <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
      
    
  </body>
</html>