
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.2.3, mkdocs-material-8.1.4">
    
    
      
        <title>L4 Testing and Serving Code - General Applications of Neural Networks</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.bb3983ee.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.e6a45f82.min.css">
        
          
          
          <meta name="theme-color" content="#2094f3">
        
      
    
    
    
      
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../extra.css">
    
      <link rel="stylesheet" href="../../styles.css">
    
    <script>__md_scope=new URL("../..",location),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      
  


  
  


  <script>window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","UA-114664473-1","auto"),ga("set","anonymizeIp",!0),ga("send","pageview"),document.addEventListener("DOMContentLoaded",function(){document.forms.search&&document.forms.search.query.addEventListener("blur",function(){var e;this.value&&(e=document.location.pathname,ga("send","pageview",e+"?q="+this.value))}),"undefined"!=typeof location$&&location$.subscribe(function(e){ga("send","pageview",e.pathname)})})</script>
  <script async src="https://www.google-analytics.com/analytics.js"></script>


    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="blue" data-md-color-accent="indigo">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#technology-fundamentals-course-4-lab-2-devops-testing-and-serving-codeipynb" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="General Applications of Neural Networks" class="md-header__button md-logo" aria-label="General Applications of Neural Networks" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            General Applications of Neural Networks
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              L4 Testing and Serving Code
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="General Applications of Neural Networks" class="md-nav__button md-logo" aria-label="General Applications of Neural Networks" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    General Applications of Neural Networks
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        About
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../introduction/" class="md-nav__link">
        Introduction
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3" type="checkbox" id="__nav_3" >
      
      
      
      
        <label class="md-nav__link" for="__nav_3">
          Sessions
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Sessions" data-md-level="1">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          Sessions
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../S1_Multilayer_Perceptron/" class="md-nav__link">
        The Multilayer Perceptron
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../S2_Feed_Forward_Neural_Networks/" class="md-nav__link">
        Feed Forward Neural Networks
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../S3_Computer_Vision_I/" class="md-nav__link">
        Computer Vision I
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../S4_Computer_Vision_II/" class="md-nav__link">
        Computer Vision II
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../S5_Time_Series_Analysis/" class="md-nav__link">
        Time Series Analysis
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4" type="checkbox" id="__nav_4" >
      
      
      
      
        <label class="md-nav__link" for="__nav_4">
          Labs
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Labs" data-md-level="1">
        <label class="md-nav__title" for="__nav_4">
          <span class="md-nav__icon md-icon"></span>
          Labs
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../L1_Neural_Network_Linearity/" class="md-nav__link">
        Neural Network Linearity
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_5" type="checkbox" id="__nav_5" >
      
      
      
      
        <label class="md-nav__link" for="__nav_5">
          Project
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Project" data-md-level="1">
        <label class="md-nav__title" for="__nav_5">
          <span class="md-nav__icon md-icon"></span>
          Project
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../project/P1_Flask/" class="md-nav__link">
        The Flask Application Factory
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                

<p><a href="https://colab.research.google.com/github/wesleybeckner/technology_fundamentals/blob/main/C4%20Machine%20Learning%20II/LABS_PROJECT/Tech_Fun_C4_L2_Testing_and_Serving_Code.ipynb" target="_parent"><img src="https://colab.research.google.com/assets/colab-badge.svg" alt="Open In Colab"/></a></p>
<h1 id="technology-fundamentals-course-4-lab-2-devops-testing-and-serving-codeipynb">Technology Fundamentals Course 4, Lab 2: DevOps: Testing and Serving Code.ipynb<a class="headerlink" href="#technology-fundamentals-course-4-lab-2-devops-testing-and-serving-codeipynb" title="Permanent link">&para;</a></h1>
<p><strong>Instructor</strong>: Wesley Beckner</p>
<p><strong>Contact</strong>: <a href="&#109;&#97;&#105;&#108;&#116;&#111;&#58;&#119;&#101;&#115;&#108;&#101;&#121;&#98;&#101;&#99;&#107;&#110;&#101;&#114;&#64;&#103;&#109;&#97;&#105;&#108;&#46;&#99;&#111;&#109;">&#119;&#101;&#115;&#108;&#101;&#121;&#98;&#101;&#99;&#107;&#110;&#101;&#114;&#64;&#103;&#109;&#97;&#105;&#108;&#46;&#99;&#111;&#109;</a></p>
<p><strong>Teaching Assitants</strong>: Varsha Bang, Harsha Vardhan</p>
<p><strong>Contact</strong>: <a href="&#109;&#97;&#105;&#108;&#116;&#111;&#58;&#118;&#98;&#97;&#110;&#103;&#64;&#117;&#119;&#46;&#101;&#100;&#117;">&#118;&#98;&#97;&#110;&#103;&#64;&#117;&#119;&#46;&#101;&#100;&#117;</a>, <a href="&#109;&#97;&#105;&#108;&#116;&#111;&#58;&#104;&#97;&#114;&#115;&#104;&#97;&#118;&#64;&#117;&#119;&#46;&#101;&#100;&#117;">&#104;&#97;&#114;&#115;&#104;&#97;&#118;&#64;&#117;&#119;&#46;&#101;&#100;&#117;</a>
<br></p>
<hr />
<p><br></p>
<p>In this lab we will practice writing unit tests (part 1) as well as serving our python code in a web framework (part 2). There is an optional part 3 where we move our unit tests into a local directory and run them with <code>pytest</code>.</p>
<p><br></p>
<hr />
<p><img src="https://www.pentalog.com/wp-content/uploads/2020/03/DevOps-engineer-job-roles-and-responsibilities.png"></img></p>
<h1 id="part-1-writing-tests">Part 1: Writing Tests<a class="headerlink" href="#part-1-writing-tests" title="Permanent link">&para;</a></h1>
<div class="codehilite"><pre><span></span><code><span class="err">!</span><span class="n">pip</span> <span class="n">install</span> <span class="n">fastapi</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code>Collecting fastapi
[?25l  Downloading https://files.pythonhosted.org/packages/4e/b9/a91a699f5c201413b3f61405dbccc29ebe5ad25945230e9cec98fdb2434c/fastapi-0.65.1-py3-none-any.whl (50kB)
[K     |████████████████████████████████| 51kB 6.8MB/s 
[?25hCollecting pydantic!=1.7,!=1.7.1,!=1.7.2,!=1.7.3,!=1.8,!=1.8.1,&lt;2.0.0,&gt;=1.6.2
[?25l  Downloading https://files.pythonhosted.org/packages/9f/f2/2d5425efe57f6c4e06cbe5e587c1fd16929dcf0eb90bd4d3d1e1c97d1151/pydantic-1.8.2-cp37-cp37m-manylinux2014_x86_64.whl (10.1MB)
[K     |████████████████████████████████| 10.1MB 35.9MB/s 
[?25hCollecting starlette==0.14.2
[?25l  Downloading https://files.pythonhosted.org/packages/15/34/db1890f442a1cd3a2c761f4109a0eb4e63503218d70a8c8e97faa09a5500/starlette-0.14.2-py3-none-any.whl (60kB)
[K     |████████████████████████████████| 61kB 9.2MB/s 
[?25hRequirement already satisfied: typing-extensions&gt;=3.7.4.3 in /usr/local/lib/python3.7/dist-packages (from pydantic!=1.7,!=1.7.1,!=1.7.2,!=1.7.3,!=1.8,!=1.8.1,&lt;2.0.0,&gt;=1.6.2-&gt;fastapi) (3.7.4.3)
Installing collected packages: pydantic, starlette, fastapi
Successfully installed fastapi-0.65.1 pydantic-1.8.2 starlette-0.14.2
</code></pre></div>

<div class="codehilite"><pre><span></span><code><span class="kn">import</span> <span class="nn">random</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">contextlib</span> <span class="kn">import</span> <span class="n">contextmanager</span>
<span class="kn">import</span> <span class="nn">sys</span><span class="o">,</span> <span class="nn">os</span>

<span class="nd">@contextmanager</span>
<span class="k">def</span> <span class="nf">suppress_stdout</span><span class="p">():</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">devnull</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">devnull</span><span class="p">:</span>
        <span class="n">old_stdout</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span> <span class="o">=</span> <span class="n">devnull</span>
        <span class="k">try</span><span class="p">:</span>  
            <span class="k">yield</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span> <span class="o">=</span> <span class="n">old_stdout</span>
</code></pre></div>

<h2 id="types-of-tests">Types of Tests<a class="headerlink" href="#types-of-tests" title="Permanent link">&para;</a></h2>
<p>There are two main types of tests we want to distinguish:
* <strong><em>Unit test</em></strong>: an automatic test to test the internal workings of a class or function. It should be a stand-alone test which is not related to other resources.
* <strong><em>Integration test</em></strong>: an automatic test that is done on an environment, it tests the coordination of different classes and functions as well as with the running environment. This usually precedes sending code to a QA team.</p>
<p>To this I will add:</p>
<ul>
<li><strong><em>Acid test</em></strong>: extremely rigorous tests that push beyond the intended use cases for your classes/functions. Written when you, like me, cannot afford QA employees to actually test your code. (word origin: <a href="https://en.wikipedia.org/wiki/Acid_test_(gold)">gold acid tests in the 1850s</a>, <a href="https://en.wikipedia.org/wiki/Acid_Tests">acid tests in the 70's</a>)</li>
</ul>
<p>In this lab we will focus on <em>unit tests</em>.</p>
<h2 id="unit-tests">Unit Tests<a class="headerlink" href="#unit-tests" title="Permanent link">&para;</a></h2>
<p>Each unit test should test the smallest portion of your code possible, i.e. a single method or function. Any random number generators should be seeded so that they run the exact same way every time. Unit tests should not rely on any local files or the local environment. </p>
<p>Why bother with Unit Tests when we have Integration tests?</p>
<p>A major challenge with integration testing is when an integration test fails. It’s very hard to diagnose a system issue without being able to isolate which part of the system is failing. Here comes the unit test to the rescue. </p>
<p>Let's take a simple example. If I wanted to test that the sume of two numbers is correct</p>
<div class="codehilite"><pre><span></span><code><span class="k">assert</span> <span class="nb">sum</span><span class="p">([</span><span class="mi">2</span><span class="p">,</span> <span class="mi">5</span><span class="p">])</span> <span class="o">==</span> <span class="mi">7</span><span class="p">,</span> <span class="s2">&quot;should be 7&quot;</span>
</code></pre></div>

<p>Nothing is sent to the print out because the condition is satisfied. If we run, however:</p>
<div class="codehilite"><pre><span></span><code>assert sum([2, 4]) == 7, &quot;should be 7&quot;
</code></pre></div>

<p>we get an error message:</p>
<div class="codehilite"><pre><span></span><code>---------------------------------------------------------------------------
AssertionError                            Traceback (most recent call last)
&lt;ipython-input-3-d5724b127818&gt; in &lt;module&gt;()
----&gt; 1 assert sum([2, 4]) == 7, &quot;should be 7&quot;

AssertionError: should be 7
</code></pre></div>

<p>To make this a Unit Test, you will want to wrap it in a function</p>
<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">test_sum</span><span class="p">():</span>
    <span class="k">assert</span> <span class="nb">sum</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">])</span> <span class="o">==</span> <span class="mi">6</span><span class="p">,</span> <span class="s2">&quot;Should be 6&quot;</span>

<span class="n">test_sum</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Everything passed&quot;</span><span class="p">)</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code>Everything passed
</code></pre></div>

<p>And if we include a test that does not pass:</p>
<div class="codehilite"><pre><span></span><code>def test_sum():
  assert sum([3, 3]) == 6, &quot;Should be 6&quot;

def test_my_broken_func():
  assert sum([1, 2]) == 5, &quot;Should be 5&quot;

test_sum()
test_my_broken_func()
print(&quot;Everything passed&quot;)
</code></pre></div>

<p>Here our test fails, because the sum of 1 and 2 is 3 and not 5. We get a traceback that tells us the source of the error:</p>
<div class="codehilite"><pre><span></span><code>---------------------------------------------------------------------------
AssertionError                            Traceback (most recent call last)
&lt;ipython-input-13-8a552fbf52bd&gt; in &lt;module&gt;()
      6 
      7 test_sum()
----&gt; 8 test_my_broken_func()
      9 print(&quot;Everything passed&quot;)

&lt;ipython-input-13-8a552fbf52bd&gt; in test_my_broken_func()
      3 
      4 def test_my_broken_func():
----&gt; 5   assert sum([1, 2]) == 5, &quot;Should be 5&quot;
      6 
      7 test_sum()

AssertionError: Should be 5
</code></pre></div>

<p>Before sending us on our merry way to practice writing unit tests, we will want to ask, what do I want to write a test about? Here, we've been testing sum(). There are many behaviors in sum() we could check, such as:</p>
<ul>
<li>Does it sum a list of whole numbers (integers)?</li>
<li>Can it sum a tuple or set?</li>
<li>Can it sum a list of floats?</li>
<li>What happens if one of the numbers is negative? etc..</li>
</ul>
<p>In the end, what you test is up to you, and depends on your intended use cases. As a general rule of thumb, your unit test should test what is relevant.</p>
<p>The only caveat to that, is that many continuous integration services (like <a href="https://travis-ci.com/">TravisCI</a>) will benchmark you based on the percentage of lines of code you have that are covered by your unit tests (ex: <a href="https://github.com/wesleybeckner/gains">85% coverage</a>).</p>
<h2 id="l2-q1-write-a-unit-test">L2 Q1 Write a Unit Test<a class="headerlink" href="#l2-q1-write-a-unit-test" title="Permanent link">&para;</a></h2>
<p>Remember our Pokeball discussion in C2? We'll return to that here. This time writing unit tests for our classes.</p>
<p>Sometimes when writing unit tests, it can be more complicated than checking the return value of a function. Think back on our pokemon example:</p>
<p><br></p>
<p align=center>
<img src="https://cdn2.bulbagarden.net/upload/thumb/2/23/Pok%C3%A9_Balls_GL.png/250px-Pok%C3%A9_Balls_GL.png"></img>


<div class="codehilite"><pre><span></span><code>class Pokeball:
  def __init__(self, contains=None, type_name=&quot;poke ball&quot;):
    self.contains = contains
    self.type_name = type_name
    self.catch_rate = 0.50 # note this attribute is not accessible upon init

  # the method catch, will update self.contains, if a catch is successful
  # it will also use self.catch_rate to set the performance of the catch
  def catch(self, pokemon):
    if self.contains == None:
      if random.random() &lt; self.catch_rate:
        self.contains = pokemon
        print(f&quot;{pokemon} captured!&quot;)
      else:
        print(f&quot;{pokemon} escaped!&quot;)
        pass
    else:
      print(&quot;pokeball is not empty!&quot;)

  def release(self):
    if self.contains == None:
      print(&quot;Pokeball is already empty&quot;)
    else:
      print(self.contains, &quot;has been released&quot;)
      self.contains = None
</code></pre></div>



If I wanted to write a unit test for the release method, I couldn't directly check for the output of a function. I'll have to check for a **_side effect_**, in this case, the change of an attribute belonging to a pokeball object; that is the change to the attribute _contains_.





<div class="codehilite"><pre><span></span><code><span class="k">class</span> <span class="nc">Pokeball</span><span class="p">:</span>
  <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">contains</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">type_name</span><span class="o">=</span><span class="s2">&quot;poke ball&quot;</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">contains</span> <span class="o">=</span> <span class="n">contains</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">type_name</span> <span class="o">=</span> <span class="n">type_name</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">catch_rate</span> <span class="o">=</span> <span class="mf">0.50</span> <span class="c1"># note this attribute is not accessible upon init</span>

  <span class="c1"># the method catch, will update self.contains, if a catch is successful</span>
  <span class="c1"># it will also use self.catch_rate to set the performance of the catch</span>
  <span class="k">def</span> <span class="nf">catch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pokemon</span><span class="p">):</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">contains</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
      <span class="k">if</span> <span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">catch_rate</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">contains</span> <span class="o">=</span> <span class="n">pokemon</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">pokemon</span><span class="si">}</span><span class="s2"> captured!&quot;</span><span class="p">)</span>
      <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">pokemon</span><span class="si">}</span><span class="s2"> escaped!&quot;</span><span class="p">)</span>
        <span class="k">pass</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;pokeball is not empty!&quot;</span><span class="p">)</span>

  <span class="k">def</span> <span class="nf">release</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">contains</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
      <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Pokeball is already empty&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="nb">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">contains</span><span class="p">,</span> <span class="s2">&quot;has been released&quot;</span><span class="p">)</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">contains</span> <span class="o">=</span> <span class="kc">None</span>
</code></pre></div>



In the following cell, finish the code to test the functionality of the _release_ method:



<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">test_release</span><span class="p">():</span>
  <span class="n">ball</span> <span class="o">=</span> <span class="n">Pokeball</span><span class="p">()</span>
  <span class="n">ball</span><span class="o">.</span><span class="n">contains</span> <span class="o">=</span> <span class="s1">&#39;Pikachu&#39;</span>
  <span class="n">ball</span><span class="o">.</span><span class="n">release</span><span class="p">()</span>
  <span class="c1"># turn the pseudo code below into an assert statement</span>

  <span class="c1">### YOUR CODE HERE ###</span>
  <span class="c1"># assert &lt;object.attribute&gt; == &lt;something&gt;</span>
</code></pre></div>





<div class="codehilite"><pre><span></span><code><span class="n">test_release</span><span class="p">()</span>
</code></pre></div>



    Pikachu has been released


## L2 Q2 Write a Unit Test for the Catch Rate

First, we will check that the succcessful catch is operating correctly. Remember that we depend on `random.random` and condition our success on whether that random value is less than the `catch_rate` of the pokeball:


<div class="codehilite"><pre><span></span><code>if self.contains == None:
      if random.random() &lt; self.catch_rate:
        self.contains = pokemon
</code></pre></div>



so to test whether the successful catch is working we will seed our random number generator with a value that returns less than the `catch_rate` of the pokeball and then write our assert statement:




<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">test_successful_catch</span><span class="p">():</span>
  <span class="c1"># choose a random seed such that</span>
  <span class="c1"># we know the catch call should succeed</span>

  <span class="c1">### YOUR CODE BELOW ###</span>
  <span class="c1"># random.seed(&lt;your number here&gt;)</span>
  <span class="n">ball</span> <span class="o">=</span> <span class="n">Pokeball</span><span class="p">()</span>
  <span class="n">ball</span><span class="o">.</span><span class="n">catch</span><span class="p">(</span><span class="s1">&#39;Psyduck&#39;</span><span class="p">)</span> <span class="c1"># Sabrina&#39;s fave pokemon</span>

  <span class="c1">### YOUR CODE BELOW ###</span>
  <span class="c1"># &lt;object.attribute&gt; == &lt;something&gt;, &quot;ball did not catch as expected&quot;</span>
</code></pre></div>



NICE. Now we will do the same thing again, this time testing for an unsuccessful catch. SO in order to do this, we need to choose a random seed that will cause our catch to fail:



<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">test_unsuccessful_catch</span><span class="p">():</span>
  <span class="c1"># choose a random seed such that</span>
  <span class="c1"># we know the catch call should FAIL</span>

  <span class="c1">### YOUR CODE BELOW ###</span>
  <span class="c1"># random.seed(&lt;your number here&gt;)</span>
  <span class="n">ball</span> <span class="o">=</span> <span class="n">Pokeball</span><span class="p">()</span>
  <span class="n">ball</span><span class="o">.</span><span class="n">catch</span><span class="p">(</span><span class="s1">&#39;Psyduck&#39;</span><span class="p">)</span> <span class="c1"># Sabrina&#39;s fave pokemon</span>

  <span class="c1">### YOUR CODE BELOW ###</span>
  <span class="c1"># &lt;object.attribute&gt; == &lt;something&gt;, &quot;ball did not fail as expected&quot;</span>
</code></pre></div>



When you are finished test your functions below



<div class="codehilite"><pre><span></span><code><span class="n">test_unsuccessful_catch</span><span class="p">()</span>
</code></pre></div>



    Psyduck captured!




<div class="codehilite"><pre><span></span><code><span class="n">test_successful_catch</span><span class="p">()</span>
</code></pre></div>



    Psyduck captured!


## L2 Q3 Write a Unit Test that Checks Whether the Overall Catch Rate is 50/50

For this one, we're going to take those same ideas around seeding the random number generator. However, here we'd like to run the catch function multiple times to check whether it is truly creating a 50/50 catch rate situation.

Here's a pseudo code outline:

1. seed the random number generator
2. for 100 iterations: 
  * create a pokeball
  * try to catch something
  * log whether it was successful
3. check that for the 100 attempts the success was approximately 50/50

_note:_ you can use my `suppress stdout()` function to suppress the print statements from `ball.catch`

ex:


<div class="codehilite"><pre><span></span><code>with suppress_stdout():
  print(&quot;HELLO OUT THERE!&quot;)
</code></pre></div>



> quick segway: what is the actual behavior of `random.seed()`? Does it produce the same number every time we call `random.random()` now? Check for yourself:



<div class="codehilite"><pre><span></span><code><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">42</span><span class="p">)</span>
<span class="p">[</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">)]</span>
</code></pre></div>






    [0.6394267984578837,
     0.025010755222666936,
     0.27502931836911926,
     0.22321073814882275,
     0.7364712141640124]



We see that it still produces random numbers with each call to `random.random`. However, those numbers are the same with every execution of the cell. What happens when we do this:



<div class="codehilite"><pre><span></span><code><span class="p">[</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">)]</span>
</code></pre></div>






    [0.6766994874229113,
     0.8921795677048454,
     0.08693883262941615,
     0.4219218196852704,
     0.029797219438070344]



The numbers are different. BUT:



<div class="codehilite"><pre><span></span><code><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">42</span><span class="p">)</span>
<span class="p">[</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">)]</span>
</code></pre></div>






    [0.6394267984578837,
     0.025010755222666936,
     0.27502931836911926,
     0.22321073814882275,
     0.7364712141640124,
     0.6766994874229113,
     0.8921795677048454,
     0.08693883262941615,
     0.4219218196852704,
     0.029797219438070344]



We see them here in the bottom half of the list again. So, random.seed() is _seeding_ the random number generator such that it will produce the same sequence of random numbers every time, from the given seed. This will reset whenever random.seed() is set again. This behavior is useful because it allows us to continue using random number generation in our code, (for testing, creating examples and demos, etc.) but it will be reproducable each time.

_End Segway_



<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">test_catch_rate</span><span class="p">():</span>
  <span class="c1">### YOUR CODE HERE ###</span>

  <span class="c1">### END YOUR CODE ###</span>
  <span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">results</span><span class="p">)</span> <span class="o">-</span> <span class="mf">0.5</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">0.1</span><span class="p">,</span> <span class="s2">&quot;catch rate not 50/50&quot;</span>
<span class="n">test_catch_rate</span><span class="p">()</span>
</code></pre></div>



## Test Runners

When we start to create many tests like this, it can be cumbersome to run them all at once and log which ones fail. To handle our unit tests we use what are called **_test runners_**. We won't dedicate time to any single one here but the three most common are:

* unittest
* nose2
* pytest

unittest is built into python. I don't like it because you have to follow a strict class/method structure when writing the tests. nose2 is popular with many useful features and is generally good for high volumes of tests. My favorite is pytest, it's flexible and has an ecosystem of plugins for extensibility. 



<div class="codehilite"><pre><span></span><code><span class="c1"># maybe have a demo of writing a file from jupyterlab cell</span>
<span class="c1"># and then running that test file with pytest</span>

<span class="c1"># conversely, could go to the actual command line since it looks like</span>
<span class="c1"># everyone has a local environment, have them clone a few files from truffletopia</span>
<span class="c1"># and demo pytest that way.</span>

<span class="err">!</span><span class="n">pytest</span> <span class="n">test_release</span>
</code></pre></div>



# Part 2: Serving Python

Our next objective is to serve our code to the wide, wide world (ahem, the world, wide, web) in as simple a manner as possible. As _s i m p l e_ as possible. 



<div class="codehilite"><pre><span></span><code><span class="kn">from</span> <span class="nn">fastapi</span> <span class="kn">import</span> <span class="n">FastAPI</span>

<span class="n">app</span> <span class="o">=</span> <span class="n">FastAPI</span><span class="p">()</span>

<span class="nd">@app</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)</span>
<span class="k">async</span> <span class="k">def</span> <span class="nf">root</span><span class="p">():</span>
    <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="s2">&quot;Hello World&quot;</span><span class="p">}</span>
</code></pre></div>



Copy the above code into a local file `main.py` 

install fastapi and uvicorn with:


<div class="codehilite"><pre><span></span><code>pip install fastapi[all]
</code></pre></div>



then from the terminal run:


<div class="codehilite"><pre><span></span><code>uvicorn main:app --reload
</code></pre></div>



`uvicorn` is the server we will use to run our fastapi application. `main` refers to the name of the file to run and `app` the object within it. `--reload` will cause the server to reboot the app anytime changes are made to the file `main.py`

You should see on the command line now something like:


<div class="codehilite"><pre><span></span><code>INFO:     Uvicorn running on http://127.0.0.1:8000 (Press CTRL+C to quit)
</code></pre></div>



This is telling us where our python app is running 

## Interactive API docs

Now go to http://127.0.0.1:8000/docs



## Recap, step by step

1. we imported fastapi

`from fastapi import FastAPI`

2. created a `FastAPI` instance

`app = FastAPI()` 

3. created a _path_ _operation_

**_path_** here refers to the last part of the URL starting from the first `/`. So in a URL like:

`truffletopia.io/basecake/chiffon`

...the path would be:

`/basecake/chiffon`

> a path is commonly referred to as an "endpoint" as in "API endpoint" or a "route"

**_operation_** refers to one of the HTTP "methods"

One of:

* `POST`: create data
* `GET`: read data
* `PUT`: update data
* `DELETE`: delete data

...and more exotic ones

We can think of these HTTP methods as synonymous with _operation_. Taking it together:

`@app.get("/")`

tells FastAPI that the function right below is in charge of handling requests that go to:

* the path `/`
* using a `get` operation

> the `@` in python is called a decorator and lets the python executor know it is going to be modifying a function in some way, in this case FastAPI's handling of the `get` requests to `/`

4. define the **_path operation function_**

* path is `/`
* operation is `GET`
* function is the funtion below the decorator

If you're curious about the `async` infront of our path operation function you can read about it [here](https://fastapi.tiangolo.com/async/#in-a-hurry).

              
            </article>
          </div>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "../..", "features": [], "translations": {"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing", "select.version.title": "Select version"}, "search": "../../assets/javascripts/workers/search.361d90f1.min.js"}</script>
    
    
      <script src="../../assets/javascripts/bundle.289a2a4b.min.js"></script>
      
        <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
      
    
  </body>
</html>